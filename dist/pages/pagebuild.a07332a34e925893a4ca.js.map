{"version":3,"sources":["webpack:///pages/pagebuild.a07332a34e925893a4ca.js","webpack:///./src/pages/pagebuild/toolbar/index.vue","webpack:///src/pages/pagebuild/app.vue","webpack:///./src/pages/pagebuild/app.vue","webpack:///./src/pages/pagebuild/toolbar/index.js","webpack:///src/pages/pagebuild/toolbar/index.vue","webpack:///./src/pages/pagebuild/toolbar/index.vue?1859","webpack:///./src/pages/pagebuild/app.vue?fde8","webpack:///./src/pages/pagebuild/app.js"],"names":["webpackJsonp","9xuP","module","exports","__webpack_require__","OTtC","XTzU","__webpack_exports__","injectStyle","ssrContext","importHtml","href","Promise","resolve","reject","link","document","createElement","onload","onerror","rel","head","appendChild","app_injectStyle","Object","defineProperty","value","layout","toolbar","name","data","mounted","methods","showAuthDialog","event","CustomEvent","detail","action","window","dispatchEvent","pagebuild_toolbar","toolbar_render","_vm","this","_h","$createElement","_c","_self","staticClass","_m","_v","attrs","title","on","click","staticRenderFns","target","aria-hidden","esExports","render","pages_pagebuild_toolbar","normalizeComponent","__vue_styles__","Component","src_pages_pagebuild_toolbar","app","policies","contracts","policyData","contractData","shouldShowAuthDialog","components","ToolBar","self","authInfo","__auth_info__","authErrorData","__auth_error_info__","addEventListener","serviceDispatchHandler","bind","checkAuthHandler","then","$widgets","getWidgets","loadWidgets","debugHandler","msg","console","warn","getStateClass","state","stateCls","isProcess","isNext","isMore","isActiveState","showPolicyDetailHandler","index","$refs","policyTable","toggleRowExpansion","showContractDetailHandler","row","expanded","contractTable","signPolicyHandler","selectedSegmentId","$message","warning","log","tip","tagInfo","resourceInfo","resourceName","$confirm","confirmButtonText","cancelButtonText","dangerouslyUseHTMLString","type","QI","fetch","method","contractType","targetId","presentableId","segmentId","serialNumber","partyTwo","__auth_user_id__","res","json","ret","errcode","splice","success","resolveContract","contract","error","catch","activateContractHandler","nextState","nextIndex","triggerHandler","promise","triggerLicense","contractId","eventId","licenseIds","params","triggerContractState","updateContractState","triggerState","targetEvents","forEach","isActivated","querySelector","querySelectorAll","resolveStateTree","root","states","push","nextStates","length","i","tmp","concat","isWait","loadResourceDetail","resourceId","status","resource","statesData","parseContract","resourceDetail","initStateNode","stateName","activatedStates","includes","curState","walkTree","node","stateNode","nextStateNode","stateMap","stateTreeRoot","fsmState","policySegment","descs","fsmDescription","initialState","desc","curStateNode","currentState","tree","authData","errorMsg","_this","authResult","authErrorCode","loadPolicyDetail","url","policy","parsePolicy","assign","segments","block","segment","selected","__auth_node_id__","Array","from","widget","prensentableId","getAttribute","fetchPresentable","text","result","JSON","parse","err","src","app_render","id","close-on-click-modal","visible","fullscreen","custom-class","width","center","update:visible","$event","label","ref","staticStyle","stripe","scopedSlots","_u","key","fn","scope","_l","_s","model","callback","$$v","$set","expression","prop","align","directives","rawName","size","$index","class","_e","placeholder","next","float","color","font-size","app_staticRenderFns","app_esExports","pagebuild_app","app_normalizeComponent","app___vue_styles__","app_Component","pages_pagebuild_app","el","h"],"mappings":"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","file":"pages\\pagebuild.a07332a34e925893a4ca.js","sourcesContent":["webpackJsonp([2],{\n\n/***/ \"9xuP\":\n/***/ (function(module, exports, __webpack_require__) {\n\n// removed by extract-text-webpack-plugin\n    if(false) {\n      // 1511770046695\n      var cssReload = require(\"../../../../node_modules/css-hot-loader/hotModuleReplacement.js\")(module.id, {\"fileMap\":\"{fileName}\"});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  \n\n/***/ }),\n\n/***/ \"OTtC\":\n/***/ (function(module, exports, __webpack_require__) {\n\n// removed by extract-text-webpack-plugin\n    if(false) {\n      // 1511770046643\n      var cssReload = require(\"../../../node_modules/css-hot-loader/hotModuleReplacement.js\")(module.id, {\"fileMap\":\"{fileName}\"});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  \n\n/***/ }),\n\n/***/ \"XTzU\":\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\nObject.defineProperty(__webpack_exports__, \"__esModule\", { value: true });\n\n// EXTERNAL MODULE: ./src/layout.js + 1 modules\nvar layout = __webpack_require__(\"rA12\");\n\n// CONCATENATED MODULE: ./src/pages/pagebuild/toolbar/index.js\n\n\n/* harmony default export */ var toolbar = ({\n    name: 'tool-bar',\n    data: function data() {\n        return {};\n    },\n    mounted: function mounted() {},\n\n    methods: {\n        showAuthDialog: function showAuthDialog() {\n            var event = new CustomEvent('freelogService', { detail: {\n                    action: 'showAuthDialog'\n                } });\n            window.dispatchEvent(event);\n        }\n    }\n});\n// CONCATENATED MODULE: ./node_modules/babel-loader/lib!./node_modules/vue-loader/lib/selector.js?type=script&index=0!./src/pages/pagebuild/toolbar/index.vue\n//\n//\n//\n//\n//\n//\n//\n\n\n/* harmony default export */ var pagebuild_toolbar = (toolbar);\n// CONCATENATED MODULE: ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-562dac57\",\"hasScoped\":true,\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/pages/pagebuild/toolbar/index.vue\nvar toolbar_render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('ul',{staticClass:\"tool-bar-wrap\"},[_vm._m(0,false,false),_vm._v(\" \"),_c('li',{staticClass:\"contract-tab\",attrs:{\"title\":\"合同管理\"},on:{\"click\":_vm.showAuthDialog}},[_c('i',{staticClass:\"el-icon-document\"})])])}\nvar staticRenderFns = [function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('li',{staticClass:\"user-tab\",attrs:{\"title\":\"个人中心\"}},[_c('a',{attrs:{\"href\":\"/pages/user/index.html\",\"target\":\"_blank\"}},[_c('i',{staticClass:\"el-icon-fa-user\",attrs:{\"aria-hidden\":\"true\"}})])])}]\nvar esExports = { render: toolbar_render, staticRenderFns: staticRenderFns }\n/* harmony default export */ var pages_pagebuild_toolbar = (esExports);\n// CONCATENATED MODULE: ./src/pages/pagebuild/toolbar/index.vue\nfunction injectStyle (ssrContext) {\n  __webpack_require__(\"9xuP\")\n}\nvar normalizeComponent = __webpack_require__(\"VU/8\")\n/* script */\n\n/* template */\n\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-562dac57\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  pagebuild_toolbar,\n  pages_pagebuild_toolbar,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\n/* harmony default export */ var src_pages_pagebuild_toolbar = (Component.exports);\n\n// CONCATENATED MODULE: ./node_modules/babel-loader/lib!./node_modules/vue-loader/lib/selector.js?type=script&index=0!./src/pages/pagebuild/app.vue\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\n\n\nfunction importHtml(href) {\n    return new Promise(function (resolve, reject) {\n        var link = document.createElement('link');\n        link.onload = resolve;\n        link.onerror = reject;\n        link.rel = 'import';\n        link.href = href;\n        document.head.appendChild(link);\n    });\n}\n\n/* harmony default export */ var app = ({\n    data: function data() {\n        return {\n            policies: [],\n            contracts: [],\n            policyData: null,\n            contractData: null,\n            shouldShowAuthDialog: true\n        };\n    },\n\n    components: { ToolBar: src_pages_pagebuild_toolbar },\n    mounted: function mounted() {\n        var self = this;\n        var authInfo = window.__auth_info__;\n        var authErrorData = authInfo.__auth_error_info__ || {};\n\n        //统一监听服务，根据action进行分发执行器\n        window.addEventListener('freelogService', self.serviceDispatchHandler.bind(self), false);\n\n        this.checkAuthHandler(authErrorData.data || {}).then(function () {\n            self.$widgets = self.getWidgets();\n            self.loadWidgets();\n        });\n    },\n\n    methods: {\n        debugHandler: function debugHandler() {\n            debugger;\n        },\n        showAuthDialog: function showAuthDialog() {\n            this.shouldShowAuthDialog = true;\n        },\n        serviceDispatchHandler: function serviceDispatchHandler(event) {\n            var detail = event.detail;\n            var data = detail.data;\n            var action = detail.action;\n\n            if (this[action]) {\n                this[action](detail);\n            } else {\n                switch (action) {\n                    case 'authService':\n                        this.checkAuthHandler(data.data, data.msg);\n                        break;\n                    default:\n                        console.warn('没有定义的服务');\n                }\n            }\n        },\n        getStateClass: function getStateClass(state) {\n            var stateCls = 'is-wait';\n            if (state.isProcess) {\n                stateCls = 'is-finish';\n            } else if (state.isNext) {\n                stateCls = 'is-process';\n            }\n\n            if (state.isMore) {\n                stateCls = 'is-more';\n            }\n\n            if (state.isActiveState) {\n                stateCls += ' is-active';\n            }\n            return stateCls;\n        },\n        showPolicyDetailHandler: function showPolicyDetailHandler(policyData, index) {\n            this.$refs.policyTable.toggleRowExpansion(policyData, true);\n        },\n        showContractDetailHandler: function showContractDetailHandler(row, index) {\n            row.expanded = true;\n            this.$refs.contractTable.toggleRowExpansion(row, true);\n        },\n        signPolicyHandler: function signPolicyHandler(policyData, index) {\n            var self = this;\n            if (!policyData.selectedSegmentId) {\n                return this.$message.warning('没有选择策略');\n            }\n\n            console.log(policyData);\n\n            var tip = 'presentable name: ' + policyData.name + ', resource name: ' + policyData.tagInfo.resourceInfo.resourceName;\n            this.$confirm('\\u5408\\u540C\\u8BE6\\u60C5\\uFF1A' + tip + '\\u3002\\u786E\\u5B9A\\u7B7E\\u7EA6\\u5408\\u540C\\uFF1F', '提示', {\n                confirmButtonText: '确定',\n                cancelButtonText: '取消',\n                dangerouslyUseHTMLString: true,\n                type: 'warning'\n            }).then(function () {\n                window.QI.fetch('//api.freelog.com/v1/contracts', {\n                    method: 'POST',\n                    data: {\n                        contractType: 3,\n                        targetId: policyData.presentableId,\n                        segmentId: policyData.selectedSegmentId,\n                        serialNumber: policyData.serialNumber,\n                        partyTwo: window.__auth_info__.__auth_user_id__\n\n                    }\n                }).then(function (res) {\n                    return res.json();\n                }).then(function (data) {\n                    if (data.ret === 0 && data.errcode === 0) {\n                        self.policies.splice(index, 1);\n                        self.$message.success('签约成功');\n                        self.resolveContract({ contract: data.data });\n                    } else {\n                        self.$message.error(data.msg);\n                    }\n                });\n            }).catch(function () {\n                //取消\n            });\n        },\n        activateContractHandler: function activateContractHandler(contract, state, nextState, nextIndex) {\n            debugger;\n            var self = this;\n            var contractId = contract.contractId;\n            var triggerState;\n\n            if (nextState) {\n                triggerState = state.targetEvents[nextIndex];\n            } else {\n                triggerState = state.targetEvents[0];\n            }\n\n            function triggerHandler(event) {\n                var promise;\n                if (event.type === 'signing') {\n                    promise = self.triggerLicense({\n                        contractId: contractId,\n                        eventId: event.eventId,\n                        licenseIds: event.params\n                    });\n                } else {\n                    promise = self.triggerContractState({\n                        contractId: contractId,\n                        eventId: event.eventId\n                    });\n                }\n\n                Promise.resolve(promise).then(function (data) {\n                    if (data.ret === 0 && data.errcode === 0) {\n                        self.$message.success('操作成功');\n                        self.updateContractState(contract, nextState);\n                    } else {\n                        self.$message.error(data.msg);\n                    }\n                });\n            }\n\n            if (triggerState.event.type === 'compoundEvents') {\n                triggerState.event.params.forEach(function (event) {\n                    triggerHandler(event);\n                });\n            } else {\n                triggerHandler(triggerState.event);\n            }\n        },\n        updateContractState: function updateContractState(contract, state) {\n            state.isProcess = true;\n            state.isActivated = true;\n        },\n        triggerLicense: function triggerLicense(data) {\n            return window.QI.fetch('//api.freelog.com/v1/contracts/signingLicenses', {\n                method: 'POST',\n                data: data\n            }).then(function (res) {\n                return res.json();\n            });\n        },\n        triggerContractState: function triggerContractState(data) {\n            return window.QI.fetch('//api.freelog.com/v1/contracts/test', {\n                method: 'POST',\n                data: data\n            }).then(function (res) {\n                return res.json();\n            });\n        },\n        getWidgets: function getWidgets() {\n            var $page = document.querySelector('#js-page-container');\n            var $widgets = $page.querySelectorAll('.js-wc-widget');\n            return $widgets;\n        },\n        resolveStateTree: function resolveStateTree(root) {\n            var states = [];\n\n            states.push(root);\n\n            if (root.nextStates.length) {\n                var nextStates = root.nextStates;\n                var nextState;\n\n                if (nextStates.length > 1) {\n                    for (var i = 0; i < nextStates.length; i++) {\n                        var tmp = nextStates[i];\n                        if (tmp.isProcess) {\n                            nextState = tmp;\n                            break;\n                        }\n                    }\n                } else {\n                    nextState = root.nextStates[0];\n                }\n\n                if (nextState) {\n                    states = states.concat(this.resolveStateTree(nextState));\n                } else if (nextStates.length > 1) {\n                    root.isMore = true;\n                    states.push({\n                        isWait: true,\n                        nextStates: nextStates\n                    });\n                }\n            }\n\n            return states;\n        },\n        loadResourceDetail: function loadResourceDetail(resourceId) {\n            return window.QI.fetch('//api.freelog.com/v1/resources/' + resourceId).then(function (res) {\n                if (res.status === 200) {\n                    return res.json();\n                } else {\n                    return Promise.reject(res);\n                }\n            }).then(function (res) {\n                if (res.ret === 0 && res.errcode === 0) {\n                    return res.data;\n                } else {\n                    return Promise.reject(res);\n                }\n            });\n        },\n        resolveContract: function resolveContract(data) {\n            var self = this;\n            var contractData = data.contract;\n            this.loadResourceDetail(contractData.resourceId).then(function (resource) {\n                contractData.statesData = self.parseContract(contractData);\n                contractData.resourceDetail = resource;\n                self.contracts.push(contractData);\n            });\n        },\n        parseContract: function parseContract(contractData) {\n            var curState = contractData.fsmState;\n            var policySegment = contractData.policySegment;\n            var descs = policySegment.fsmDescription;\n            var activatedStates = policySegment.activatedStates;\n            var initialState = policySegment.initialState;\n            var stateMap = {};\n            var stateTreeRoot;\n\n            function initStateNode(stateName) {\n                return {\n                    nextStates: [],\n                    targetEvents: [], //到下一状态可能的路径(事件)\n                    state: stateName,\n                    isActiveState: activatedStates.includes(stateName),\n                    isProcess: stateName === curState\n                };\n            }\n\n            function walkTree(node) {\n                if (!node.nextStates.length) {\n                    return;\n                }\n\n                node.nextStates.forEach(function (stateNode) {\n                    var nextStateNode = stateMap[stateNode.state];\n                    //                        nextStateNode.isNext = node.isProcess\n\n                    if (nextStateNode.targetEvents.length) {\n                        nextStateNode.targetEvents.forEach(function (event) {\n                            if (stateMap[event.nextState] && event.nextState !== node.state) {\n                                nextStateNode.nextStates.push(stateMap[event.nextState]);\n                            }\n                        });\n                    }\n                    walkTree(nextStateNode);\n                });\n            }\n\n            descs.forEach(function (desc) {\n                var curStateNode = stateMap[desc.currentState] || initStateNode(desc.currentState);\n                var nextStateNode = stateMap[desc.nextState];\n\n                curStateNode.targetEvents.push(desc);\n\n                if (!nextStateNode) {\n                    nextStateNode = initStateNode(desc.nextState);\n                    stateMap[desc.nextState] = nextStateNode;\n                }\n\n                //标记根节点的next，便于初始化遍历\n                if (desc.currentState === initialState) {\n                    curStateNode.nextStates.push(nextStateNode);\n                }\n                stateMap[desc.currentState] = curStateNode;\n            });\n\n            stateTreeRoot = stateMap[initialState];\n            walkTree(stateTreeRoot);\n\n            var tree = this.resolveStateTree(stateTreeRoot);\n            console.log(tree);\n\n            return { stateTreeRoot: stateTreeRoot, stateMap: stateMap };\n        },\n        checkAuthHandler: function checkAuthHandler(authData, errorMsg) {\n            var _this = this;\n\n            var self = this;\n\n            return new Promise(function (resolve, reject) {\n                //如果有报错信息\n                if (authData.authResult) {\n                    self.shouldShowAuthDialog = true;\n                    switch (authData.authResult.authErrorCode) {\n                        //未激活状态\n                        case 70080104:\n                            _this.resolveContract(authData.data);\n                            break;\n                        //未签约状态\n                        case 70080101:\n                            _this.loadPolicyDetail(authData.data);\n                            break;\n                        //节点与资源之间的合约授权失败\n                        case 70080202:\n                            console.log(errorMsg, authData.data);\n                            self.$message.warning(errorMsg);\n                            break;\n                        default:\n                            resolve();\n                            break;\n                    }\n                } else {\n                    resolve();\n                }\n            });\n        },\n        loadPolicyDetail: function loadPolicyDetail(authData) {\n            var self = this;\n            var presentableId = authData.presentableId;\n            var url = '//api.freelog.com/v1/presentables/' + presentableId;\n            window.QI.fetch(url).then(function (res) {\n                return res.json();\n            }).then(function (data) {\n                var policy = self.parsePolicy(data.data, presentableId);\n                policy.presentableId = presentableId;\n                self.policies.push(policy);\n                console.log(policy);\n            });\n        },\n        parsePolicy: function parsePolicy(data) {\n            var self = this;\n            var policies = data;\n            var policyData = policies;\n            Object.assign(policyData, {\n                segments: [],\n                selectedSegmentId: ''\n            });\n            policies.policy.forEach(function (block) {\n                var segment = {\n                    detail: block,\n                    states: block.fsmDescription,\n                    selected: false\n                };\n\n                policyData.segments.push(segment);\n            });\n\n            return policyData;\n        },\n        loadWidgets: function loadWidgets() {\n            var self = this;\n            var $widgets = this.$widgets;\n            var url = '//api.freelog.com/v1/nodes/' + window.__auth_info__.__auth_node_id__ + '/presentables/';\n            Array.from($widgets).forEach(function (widget) {\n                var prensentableId = widget.getAttribute('data-widget-presentable-id');\n                if (prensentableId) {\n                    window.QI.fetchPresentable(prensentableId + '.data').then(function (res) {\n                        return res.text();\n                    }).then(function (data) {\n                        try {\n                            var result = JSON.parse(data);\n                            self.checkAuthHandler(result.data, result.msg);\n                        } catch (err) {\n                            //json解析不成功默认是成功情况\n                            //                                console.log(err)\n                            var src = url + (prensentableId + '.data');\n                            importHtml(src);\n                        }\n                    });\n                } else {}\n            });\n        }\n    }\n});\n// CONCATENATED MODULE: ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-2e1372de\",\"hasScoped\":true,\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/pages/pagebuild/app.vue\nvar app_render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{attrs:{\"id\":\"app\"}},[_c('tool-bar'),_vm._v(\" \"),_c('el-dialog',{attrs:{\"close-on-click-modal\":false,\"title\":\"签约\",\"visible\":_vm.shouldShowAuthDialog,\"fullscreen\":false,\"custom-class\":\"auth-dialog\",\"width\":\"50%\",\"center\":\"\"},on:{\"update:visible\":function($event){_vm.shouldShowAuthDialog=$event}}},[_c('el-tabs',{attrs:{\"type\":\"border-card\",\"value\":\"contract\"}},[_c('el-tab-pane',{attrs:{\"label\":\"签约合同\"}},[_c('el-table',{ref:\"policyTable\",staticStyle:{\"width\":\"100%\"},attrs:{\"data\":_vm.policies,\"stripe\":\"\"}},[_c('el-table-column',{attrs:{\"type\":\"expand\"},scopedSlots:_vm._u([{key:\"default\",fn:function(scope){return [_c('ul',_vm._l((scope.row.segments),function(segment){return _c('li',{staticClass:\"segment-row\"},[_c('span',{staticClass:\"segment-detail\"},[_vm._v(\"合同ID \"+_vm._s(segment.detail.segmentId))]),_vm._v(\" \"),_c('el-radio',{staticClass:\"select-btn\",attrs:{\"label\":segment.detail.segmentId},model:{value:(scope.row.selectedSegmentId),callback:function ($$v) {_vm.$set(scope.row, \"selectedSegmentId\", $$v)},expression:\"scope.row.selectedSegmentId\"}},[_vm._v(\"选择\\n                                    \")])],1)}))]}}])}),_vm._v(\" \"),_c('el-table-column',{attrs:{\"label\":\"合同名称\",\"prop\":\"name\"}}),_vm._v(\" \"),_c('el-table-column',{attrs:{\"label\":\"资源名称\",\"prop\":\"tagInfo.resourceInfo.resourceName\"}}),_vm._v(\" \"),_c('el-table-column',{attrs:{\"label\":\"资源类型\",\"prop\":\"tagInfo.resourceInfo.resourceType\",\"width\":\"120px\"}}),_vm._v(\" \"),_c('el-table-column',{attrs:{\"label\":\"操作\",\"align\":\"center\",\"width\":\"120px\"},scopedSlots:_vm._u([{key:\"default\",fn:function(scope){return [_c('el-button',{directives:[{name:\"show\",rawName:\"v-show\",value:(!!scope.row.selectedSegmentId),expression:\"!!scope.row.selectedSegmentId\"}],attrs:{\"size\":\"mini\"},on:{\"click\":function($event){_vm.signPolicyHandler(scope.row, scope.$index)}}},[_vm._v(\"\\n                                签约\\n                            \")]),_vm._v(\" \"),_c('el-button',{directives:[{name:\"show\",rawName:\"v-show\",value:(!scope.row.selectedSegmentId),expression:\"!scope.row.selectedSegmentId\"}],attrs:{\"size\":\"mini\"},on:{\"click\":function($event){_vm.showPolicyDetailHandler(scope.row, scope.$index)}}},[_vm._v(\"\\n                                查看合同\\n                            \")])]}}])})],1)],1),_vm._v(\" \"),_c('el-tab-pane',{attrs:{\"label\":\"合同管理\",\"name\":\"contract\"}},[_c('el-table',{ref:\"contractTable\",staticStyle:{\"width\":\"100%\"},attrs:{\"stripe\":\"\",\"data\":_vm.contracts}},[_c('el-table-column',{attrs:{\"type\":\"expand\"},scopedSlots:_vm._u([{key:\"default\",fn:function(scope){return [_c('h3',{staticClass:\"contract-title\"},[_vm._v(\"合同流程\")]),_vm._v(\" \"),_c('ul',{staticClass:\"state-steps\"},_vm._l((_vm.resolveStateTree(scope.row.statesData.stateTreeRoot)),function(state,index){return _c('li',{staticClass:\"state-step\",class:[\n                                _vm.getStateClass(state)\n                                ]},[_c('div',{staticClass:\"state-main\"},[_c('div',{staticClass:\"state-title\"},[(state.state)?_c('span',[_vm._v(\"\\n                                                \"+_vm._s(state.state)+\" \"),_c('i',{staticClass:\"dot\"})]):(state.isWait)?_c('div',{staticClass:\"wait-state\"},[_c('i',{staticClass:\"el-icon-more\"})]):_vm._e()]),_vm._v(\" \"),_c('div',{staticClass:\"state-step-arrow\"},[(state.isMore)?_c('el-select',{attrs:{\"size\":\"mini\",\"placeholder\":\"请选择\"},model:{value:(state.selected),callback:function ($$v) {_vm.$set(state, \"selected\", $$v)},expression:\"state.selected\"}},_vm._l((state.nextStates),function(next,nextIndex){return _c('el-option',{key:\"\",attrs:{\"label\":next.state,\"value\":next.state}},[_c('span',{staticStyle:{\"float\":\"left\"}},[_vm._v(_vm._s(next.state))]),_vm._v(\" \"),_c('span',{staticStyle:{\"float\":\"right\",\"color\":\"#8492a6\",\"font-size\":\"13px\"},on:{\"click\":function($event){_vm.activateContractHandler(scope.row, state, next, nextIndex)}}},[_vm._v(\"trigger\")])])})):(state.isProcess)?_c('el-button',{attrs:{\"size\":\"mini\"},on:{\"click\":function($event){_vm.activateContractHandler(scope.row, state)}}},[_vm._v(\"trigger\"),_c('i',{staticClass:\"el-icon-arrow-right\"})]):_vm._e(),_vm._v(\" \"),_c('i',{staticClass:\"el-icon-arrow-right\"})],1)])])}))]}}])}),_vm._v(\" \"),_c('el-table-column',{attrs:{\"label\":\"合同ID\",\"prop\":\"contractId\",\"width\":\"240px\"}}),_vm._v(\" \"),_c('el-table-column',{attrs:{\"label\":\"资源名称\",\"prop\":\"resourceDetail.resourceName\"}}),_vm._v(\" \"),_c('el-table-column',{attrs:{\"label\":\"资源类型\",\"prop\":\"resourceDetail.resourceType\",\"width\":\"120px\"}}),_vm._v(\" \"),_c('el-table-column',{attrs:{\"label\":\"操作\",\"align\":\"center\",\"width\":\"150px\"},scopedSlots:_vm._u([{key:\"default\",fn:function(scope){return [_c('el-button',{attrs:{\"size\":\"mini\"},on:{\"click\":function($event){_vm.showContractDetailHandler(scope.row, scope.$index)}}},[_vm._v(\"\\n                                查看合同流程\\n                            \")])]}}])})],1)],1)],1)],1)],1)}\nvar app_staticRenderFns = []\nvar app_esExports = { render: app_render, staticRenderFns: app_staticRenderFns }\n/* harmony default export */ var pagebuild_app = (app_esExports);\n// CONCATENATED MODULE: ./src/pages/pagebuild/app.vue\nfunction app_injectStyle (ssrContext) {\n  __webpack_require__(\"OTtC\")\n}\nvar app_normalizeComponent = __webpack_require__(\"VU/8\")\n/* script */\n\n/* template */\n\n/* template functional */\nvar app___vue_template_functional__ = false\n/* styles */\nvar app___vue_styles__ = app_injectStyle\n/* scopeId */\nvar app___vue_scopeId__ = \"data-v-2e1372de\"\n/* moduleIdentifier (server only) */\nvar app___vue_module_identifier__ = null\nvar app_Component = app_normalizeComponent(\n  app,\n  pagebuild_app,\n  app___vue_template_functional__,\n  app___vue_styles__,\n  app___vue_scopeId__,\n  app___vue_module_identifier__\n)\n\n/* harmony default export */ var pages_pagebuild_app = (app_Component.exports);\n\n// CONCATENATED MODULE: ./src/pages/pagebuild/app.js\n\n\n\n\nwindow.QI = document.querySelector('.js-lib-qi');\n\nnew layout[\"a\" /* default */]({\n    el: '#app',\n    render: function render(h) {\n        return h(pages_pagebuild_app);\n    }\n});\n\n/***/ })\n\n},[\"XTzU\"]);\n\n\n// WEBPACK FOOTER //\n// pages/pagebuild.a07332a34e925893a4ca.js","function injectStyle (ssrContext) {\n  require(\"!!css-hot-loader!../../../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!style-loader!css-loader!../../../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-562dac57\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!postcss-loader!less-loader!../../../../node_modules/vue-loader/lib/selector?type=styles&index=0!./index.vue\")\n}\nvar normalizeComponent = require(\"!../../../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nimport __vue_script__ from \"!!babel-loader!../../../../node_modules/vue-loader/lib/selector?type=script&index=0!./index.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-562dac57\\\",\\\"hasScoped\\\":true,\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../../node_modules/vue-loader/lib/selector?type=template&index=0!./index.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-562dac57\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/pages/pagebuild/toolbar/index.vue\n// module id = null\n// module chunks = ","<template>\r\n    <div id=\"app\">\r\n        <tool-bar></tool-bar>\r\n        <el-dialog\r\n                :close-on-click-modal=\"false\"\r\n                title=\"签约\"\r\n                :visible.sync=\"shouldShowAuthDialog\"\r\n                :fullscreen=\"false\"\r\n                custom-class=\"auth-dialog\"\r\n                width=\"50%\"\r\n                center>\r\n            <el-tabs type=\"border-card\" value=\"contract\">\r\n                <el-tab-pane label=\"签约合同\">\r\n                    <el-table\r\n                            :data=\"policies\"\r\n                            ref=\"policyTable\"\r\n                            stripe\r\n                            style=\"width: 100%\">\r\n                        <el-table-column type=\"expand\">\r\n                            <template slot-scope=\"scope\">\r\n                                <ul>\r\n                                    <li v-for=\"segment in scope.row.segments\" class=\"segment-row\">\r\n                                        <span class=\"segment-detail\">合同ID {{segment.detail.segmentId}}</span>\r\n                                        <el-radio class=\"select-btn\" v-model=\"scope.row.selectedSegmentId\"\r\n                                                  :label=\"segment.detail.segmentId\">选择\r\n                                        </el-radio>\r\n                                    </li>\r\n                                </ul>\r\n                            </template>\r\n                        </el-table-column>\r\n                        <el-table-column\r\n                                label=\"合同名称\"\r\n                                prop=\"name\">\r\n                        </el-table-column>\r\n                        <el-table-column\r\n                                label=\"资源名称\"\r\n                                prop=\"tagInfo.resourceInfo.resourceName\">\r\n                        </el-table-column>\r\n                        <el-table-column\r\n                                label=\"资源类型\"\r\n                                prop=\"tagInfo.resourceInfo.resourceType\"\r\n                                width=\"120px\">\r\n                        </el-table-column>\r\n                        <el-table-column label=\"操作\" align=\"center\" width=\"120px\">\r\n                            <template slot-scope=\"scope\">\r\n                                <el-button\r\n                                        size=\"mini\"\r\n                                        @click=\"signPolicyHandler(scope.row, scope.$index)\"\r\n                                        v-show=\"!!scope.row.selectedSegmentId\">\r\n                                    签约\r\n                                </el-button>\r\n                                <el-button\r\n                                        v-show=\"!scope.row.selectedSegmentId\"\r\n                                        size=\"mini\"\r\n                                        @click=\"showPolicyDetailHandler(scope.row, scope.$index)\">\r\n                                    查看合同\r\n                                </el-button>\r\n                            </template>\r\n                        </el-table-column>\r\n                    </el-table>\r\n                </el-tab-pane>\r\n                <el-tab-pane label=\"合同管理\" name=\"contract\">\r\n                    <el-table\r\n                            stripe\r\n                            :data=\"contracts\"\r\n                            ref=\"contractTable\"\r\n                            style=\"width: 100%\">\r\n                        <el-table-column type=\"expand\">\r\n                            <template slot-scope=\"scope\">\r\n                                <h3 class=\"contract-title\">合同流程</h3>\r\n                                <ul class=\"state-steps\">\r\n                                    <li class=\"state-step\"\r\n                                        v-for=\"(state, index) in resolveStateTree(scope.row.statesData.stateTreeRoot)\"\r\n                                        :class=\"[\r\n                                    getStateClass(state)\r\n                                    ]\">\r\n                                        <div class=\"state-main\">\r\n                                            <div class=\"state-title\">\r\n                                                <span v-if=\"state.state\">\r\n                                                    {{state.state}} <i class=\"dot\"></i>\r\n                                                </span>\r\n                                                <div v-else-if=\"state.isWait\" class=\"wait-state\">\r\n                                                    <i class=\"el-icon-more\"></i>\r\n                                                </div>\r\n                                            </div>\r\n\r\n                                            <div class=\"state-step-arrow\">\r\n                                                <el-select v-model=\"state.selected\"\r\n                                                           size=\"mini\"\r\n                                                           v-if=\"state.isMore\"\r\n                                                           placeholder=\"请选择\">\r\n                                                    <el-option\r\n                                                            v-for=\"(next,nextIndex) in state.nextStates\"\r\n                                                            key=\"\"\r\n                                                            :label=\"next.state\"\r\n                                                            :value=\"next.state\">\r\n                                                        <span style=\"float: left\">{{ next.state }}</span>\r\n                                                        <span style=\"float: right; color: #8492a6; font-size: 13px\"\r\n                                                              @click=\"activateContractHandler(scope.row, state, next, nextIndex)\">trigger</span>\r\n                                                    </el-option>\r\n                                                </el-select>\r\n                                                <el-button size=\"mini\" v-else-if=\"state.isProcess\"\r\n                                                           @click=\"activateContractHandler(scope.row, state)\">trigger<i\r\n                                                        class=\"el-icon-arrow-right\"></i></el-button>\r\n                                                <i class=\"el-icon-arrow-right\"></i>\r\n\r\n                                            </div>\r\n                                        </div>\r\n                                    </li>\r\n                                </ul>\r\n                            </template>\r\n                        </el-table-column>\r\n                        <el-table-column\r\n                                label=\"合同ID\"\r\n                                prop=\"contractId\"\r\n                                width=\"240px\">\r\n                        </el-table-column>\r\n                        <el-table-column\r\n                                label=\"资源名称\"\r\n                                prop=\"resourceDetail.resourceName\">\r\n                        </el-table-column>\r\n                        <el-table-column\r\n                                label=\"资源类型\"\r\n                                prop=\"resourceDetail.resourceType\"\r\n                                width=\"120px\">\r\n                        </el-table-column>\r\n                        <el-table-column label=\"操作\" align=\"center\" width=\"150px\">\r\n                            <template slot-scope=\"scope\">\r\n                                <!--v-show=\"!scope.row.expanded\"-->\r\n                                <el-button\r\n                                        size=\"mini\"\r\n                                        @click=\"showContractDetailHandler(scope.row, scope.$index)\">\r\n                                    查看合同流程\r\n                                </el-button>\r\n                            </template>\r\n                        </el-table-column>\r\n                    </el-table>\r\n                </el-tab-pane>\r\n            </el-tabs>\r\n        </el-dialog>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\n    import ToolBar from './toolbar/index.vue'\r\n\r\n    function importHtml(href) {\r\n        return new Promise(function (resolve, reject) {\r\n            const link = document.createElement('link');\r\n            link.onload = resolve;\r\n            link.onerror = reject;\r\n            link.rel = 'import';\r\n            link.href = href;\r\n            document.head.appendChild(link);\r\n        });\r\n    }\r\n\r\n\r\n    export default {\r\n        data() {\r\n            return {\r\n                policies: [],\r\n                contracts: [],\r\n                policyData: null,\r\n                contractData: null,\r\n                shouldShowAuthDialog: true\r\n            }\r\n        },\r\n        components: {ToolBar},\r\n        mounted() {\r\n            var self = this\r\n            var authInfo = window.__auth_info__;\r\n            var authErrorData = authInfo.__auth_error_info__ || {}\r\n\r\n\r\n            //统一监听服务，根据action进行分发执行器\r\n            window.addEventListener('freelogService', self.serviceDispatchHandler.bind(self), false)\r\n\r\n            this.checkAuthHandler(authErrorData.data || {})\r\n                .then(() => {\r\n                    self.$widgets = self.getWidgets()\r\n                    self.loadWidgets()\r\n                })\r\n        },\r\n        methods: {\r\n            debugHandler() {\r\n                debugger\r\n            },\r\n            showAuthDialog(){\r\n                this.shouldShowAuthDialog = true;\r\n            },\r\n            serviceDispatchHandler(event) {\r\n                var detail = event.detail;\r\n                var data = detail.data;\r\n                var action = detail.action\r\n\r\n                if (this[action]) {\r\n                    this[action](detail)\r\n                } else {\r\n                    switch (action) {\r\n                        case 'authService':\r\n                            this.checkAuthHandler(data.data, data.msg)\r\n                            break;\r\n                        default:\r\n                            console.warn('没有定义的服务');\r\n                    }\r\n                }\r\n            },\r\n            getStateClass(state) {\r\n                var stateCls = 'is-wait'\r\n                if (state.isProcess) {\r\n                    stateCls = 'is-finish'\r\n                } else if (state.isNext) {\r\n                    stateCls = 'is-process'\r\n                }\r\n\r\n                if (state.isMore) {\r\n                    stateCls = 'is-more'\r\n                }\r\n\r\n                if (state.isActiveState) {\r\n                    stateCls += ' is-active'\r\n                }\r\n                return stateCls\r\n            },\r\n            showPolicyDetailHandler(policyData, index) {\r\n                this.$refs.policyTable.toggleRowExpansion(policyData, true)\r\n            },\r\n            showContractDetailHandler(row, index) {\r\n                row.expanded = true\r\n                this.$refs.contractTable.toggleRowExpansion(row, true)\r\n            },\r\n            signPolicyHandler(policyData, index) {\r\n                var self = this;\r\n                if (!policyData.selectedSegmentId) {\r\n                    return this.$message.warning('没有选择策略')\r\n                }\r\n\r\n                console.log(policyData)\r\n\r\n                var tip = `presentable name: ${policyData.name}, resource name: ${policyData.tagInfo.resourceInfo.resourceName}`\r\n                this.$confirm(`合同详情：${tip}。确定签约合同？`, '提示', {\r\n                    confirmButtonText: '确定',\r\n                    cancelButtonText: '取消',\r\n                    dangerouslyUseHTMLString: true,\r\n                    type: 'warning'\r\n                }).then(() => {\r\n                    window.QI.fetch('//api.freelog.com/v1/contracts', {\r\n                        method: 'POST',\r\n                        data: {\r\n                            contractType: 3,\r\n                            targetId: policyData.presentableId,\r\n                            segmentId: policyData.selectedSegmentId,\r\n                            serialNumber: policyData.serialNumber,\r\n                            partyTwo: window.__auth_info__.__auth_user_id__\r\n\r\n                        }\r\n                    }).then((res) => {\r\n                        return res.json()\r\n                    }).then((data) => {\r\n                        if (data.ret === 0 && data.errcode === 0) {\r\n                            self.policies.splice(index, 1)\r\n                            self.$message.success('签约成功')\r\n                            self.resolveContract({contract: data.data})\r\n                        } else {\r\n                            self.$message.error(data.msg)\r\n                        }\r\n                    })\r\n                }).catch(() => {\r\n                    //取消\r\n                });\r\n            },\r\n            activateContractHandler(contract, state, nextState, nextIndex) {\r\n                debugger\r\n                var self = this;\r\n                var contractId = contract.contractId\r\n                var triggerState\r\n\r\n                if (nextState) {\r\n                    triggerState = state.targetEvents[nextIndex]\r\n                } else {\r\n                    triggerState = state.targetEvents[0]\r\n                }\r\n\r\n                function triggerHandler(event) {\r\n                    var promise;\r\n                    if (event.type === 'signing') {\r\n                        promise = self.triggerLicense({\r\n                            contractId: contractId,\r\n                            eventId: event.eventId,\r\n                            licenseIds: event.params\r\n                        })\r\n                    } else {\r\n                        promise = self.triggerContractState({\r\n                            contractId: contractId,\r\n                            eventId: event.eventId\r\n                        })\r\n                    }\r\n\r\n                    Promise.resolve(promise).then((data) => {\r\n                        if (data.ret === 0 && data.errcode === 0) {\r\n                            self.$message.success('操作成功');\r\n                            self.updateContractState(contract, nextState)\r\n                        } else {\r\n                            self.$message.error(data.msg)\r\n                        }\r\n                    })\r\n                }\r\n\r\n                if (triggerState.event.type === 'compoundEvents') {\r\n                    triggerState.event.params.forEach((event) => {\r\n                        triggerHandler(event)\r\n                    })\r\n                } else {\r\n                    triggerHandler(triggerState.event)\r\n                }\r\n            },\r\n            updateContractState(contract, state) {\r\n                state.isProcess = true\r\n                state.isActivated = true;\r\n            },\r\n            triggerLicense(data) {\r\n                return window.QI.fetch('//api.freelog.com/v1/contracts/signingLicenses', {\r\n                    method: 'POST',\r\n                    data: data\r\n                }).then((res) => {\r\n                    return res.json()\r\n                })\r\n            },\r\n            triggerContractState(data) {\r\n                return window.QI.fetch('//api.freelog.com/v1/contracts/test', {\r\n                    method: 'POST',\r\n                    data: data\r\n                }).then((res) => {\r\n                    return res.json()\r\n                })\r\n            },\r\n            getWidgets() {\r\n                var $page = document.querySelector('#js-page-container')\r\n                var $widgets = $page.querySelectorAll('.js-wc-widget');\r\n                return $widgets\r\n            },\r\n            resolveStateTree(root) {\r\n                var states = []\r\n\r\n                states.push(root)\r\n\r\n                if (root.nextStates.length) {\r\n                    var nextStates = root.nextStates;\r\n                    var nextState\r\n\r\n                    if (nextStates.length > 1) {\r\n                        for (var i = 0; i < nextStates.length; i++) {\r\n                            var tmp = nextStates[i]\r\n                            if (tmp.isProcess) {\r\n                                nextState = tmp\r\n                                break\r\n                            }\r\n                        }\r\n                    } else {\r\n                        nextState = root.nextStates[0]\r\n                    }\r\n\r\n                    if (nextState) {\r\n                        states = states.concat(this.resolveStateTree(nextState))\r\n                    } else if (nextStates.length > 1) {\r\n                        root.isMore = true\r\n                        states.push({\r\n                            isWait: true,\r\n                            nextStates: nextStates\r\n                        })\r\n                    }\r\n                }\r\n\r\n                return states\r\n            },\r\n            loadResourceDetail(resourceId) {\r\n                return window.QI.fetch(`//api.freelog.com/v1/resources/${resourceId}`).then((res) => {\r\n                    if (res.status === 200) {\r\n                        return res.json()\r\n                    } else {\r\n                        return Promise.reject(res)\r\n                    }\r\n                }).then((res) => {\r\n                    if (res.ret === 0 && res.errcode === 0) {\r\n                        return res.data\r\n                    } else {\r\n                        return Promise.reject(res)\r\n                    }\r\n                })\r\n            },\r\n            resolveContract(data) {\r\n                var self = this;\r\n                var contractData = data.contract\r\n                this.loadResourceDetail(contractData.resourceId)\r\n                    .then((resource) => {\r\n                        contractData.statesData = self.parseContract(contractData)\r\n                        contractData.resourceDetail = resource\r\n                        self.contracts.push(contractData)\r\n                    })\r\n            },\r\n            parseContract(contractData) {\r\n                var curState = contractData.fsmState\r\n                var policySegment = contractData.policySegment\r\n                var descs = policySegment.fsmDescription\r\n                var activatedStates = policySegment.activatedStates\r\n                var initialState = policySegment.initialState\r\n                var stateMap = {}\r\n                var stateTreeRoot;\r\n\r\n                function initStateNode(stateName) {\r\n                    return {\r\n                        nextStates: [],\r\n                        targetEvents: [], //到下一状态可能的路径(事件)\r\n                        state: stateName,\r\n                        isActiveState: activatedStates.includes(stateName),\r\n                        isProcess: stateName === curState\r\n                    };\r\n                }\r\n\r\n                function walkTree(node) {\r\n                    if (!node.nextStates.length) {\r\n                        return\r\n                    }\r\n\r\n                    node.nextStates.forEach(function (stateNode) {\r\n                        var nextStateNode = stateMap[stateNode.state]\r\n//                        nextStateNode.isNext = node.isProcess\r\n\r\n                        if (nextStateNode.targetEvents.length) {\r\n                            nextStateNode.targetEvents.forEach(function (event) {\r\n                                if (stateMap[event.nextState] && event.nextState !== node.state) {\r\n                                    nextStateNode.nextStates.push(stateMap[event.nextState])\r\n                                }\r\n                            })\r\n                        }\r\n                        walkTree(nextStateNode)\r\n                    })\r\n                }\r\n\r\n                descs.forEach((desc) => {\r\n                    var curStateNode = stateMap[desc.currentState] || initStateNode(desc.currentState)\r\n                    var nextStateNode = stateMap[desc.nextState]\r\n\r\n                    curStateNode.targetEvents.push(desc)\r\n\r\n                    if (!nextStateNode) {\r\n                        nextStateNode = initStateNode(desc.nextState);\r\n                        stateMap[desc.nextState] = nextStateNode\r\n                    }\r\n\r\n                    //标记根节点的next，便于初始化遍历\r\n                    if (desc.currentState === initialState) {\r\n                        curStateNode.nextStates.push(nextStateNode)\r\n                    }\r\n                    stateMap[desc.currentState] = curStateNode\r\n                })\r\n\r\n                stateTreeRoot = stateMap[initialState]\r\n                walkTree(stateTreeRoot)\r\n\r\n                var tree = this.resolveStateTree(stateTreeRoot);\r\n                console.log(tree)\r\n\r\n                return {stateTreeRoot, stateMap}\r\n            },\r\n            checkAuthHandler(authData, errorMsg) {\r\n                var self = this;\r\n\r\n                return new Promise((resolve, reject) => {\r\n                    //如果有报错信息\r\n                    if (authData.authResult) {\r\n                        self.shouldShowAuthDialog = true\r\n                        switch (authData.authResult.authErrorCode) {\r\n                            //未激活状态\r\n                            case 70080104:\r\n                                this.resolveContract(authData.data);\r\n                                break;\r\n                            //未签约状态\r\n                            case 70080101:\r\n                                this.loadPolicyDetail(authData.data);\r\n                                break;\r\n                            //节点与资源之间的合约授权失败\r\n                            case 70080202:\r\n                                console.log(errorMsg, authData.data)\r\n                                self.$message.warning(errorMsg)\r\n                                break;\r\n                            default:\r\n                                resolve();\r\n                                break;\r\n                        }\r\n                    } else {\r\n                        resolve()\r\n                    }\r\n                })\r\n            },\r\n            loadPolicyDetail(authData) {\r\n                var self = this\r\n                var presentableId = authData.presentableId;\r\n                var url = '//api.freelog.com/v1/presentables/' + presentableId;\r\n                window.QI.fetch(url).then(function (res) {\r\n                    return res.json();\r\n                }).then(function (data) {\r\n                    var policy = self.parsePolicy(data.data, presentableId)\r\n                    policy.presentableId = presentableId\r\n                    self.policies.push(policy)\r\n                    console.log(policy)\r\n                })\r\n            },\r\n            parsePolicy(data) {\r\n                var self = this;\r\n                var policies = data;\r\n                var policyData = policies;\r\n                Object.assign(policyData, {\r\n                    segments: [],\r\n                    selectedSegmentId: ''\r\n                })\r\n                policies.policy.forEach(function (block) {\r\n                    var segment = {\r\n                        detail: block,\r\n                        states: block.fsmDescription,\r\n                        selected: false\r\n                    }\r\n\r\n                    policyData.segments.push(segment)\r\n                })\r\n\r\n\r\n                return policyData\r\n            },\r\n\r\n            loadWidgets() {\r\n                var self = this;\r\n                var $widgets = this.$widgets\r\n                var url = `//api.freelog.com/v1/nodes/${window.__auth_info__.__auth_node_id__}/presentables/`\r\n                Array.from($widgets).forEach(function (widget) {\r\n                    var prensentableId = widget.getAttribute('data-widget-presentable-id');\r\n                    if (prensentableId) {\r\n                        window.QI.fetchPresentable(`${prensentableId}.data`)\r\n                            .then((res) => {\r\n                                return res.text()\r\n                            }).then(function (data) {\r\n                            try {\r\n                                var result = JSON.parse(data)\r\n                                self.checkAuthHandler(result.data, result.msg)\r\n                            } catch (err) {\r\n                                //json解析不成功默认是成功情况\r\n//                                console.log(err)\r\n                                var src = url + `${prensentableId}.data`;\r\n                                importHtml(src)\r\n                            }\r\n                        })\r\n                    } else {\r\n\r\n                    }\r\n                })\r\n            }\r\n\r\n        }\r\n    }\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n    @import \"./app.less\";\r\n\r\n    .event-state {\r\n        padding: 5px;\r\n        font-size: 16px;\r\n    }\r\n\r\n    .current-state {\r\n        color: #35b5ff;\r\n    }\r\n\r\n    .policy-wrap {\r\n        text-align: center;\r\n    }\r\n\r\n    .active-state {\r\n        color: #67C23A;\r\n    }\r\n</style>\r\n\n\n\n// WEBPACK FOOTER //\n// src/pages/pagebuild/app.vue","function injectStyle (ssrContext) {\n  require(\"!!css-hot-loader!../../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!style-loader!css-loader!../../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-2e1372de\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!postcss-loader!less-loader!../../../node_modules/vue-loader/lib/selector?type=styles&index=0!./app.vue\")\n}\nvar normalizeComponent = require(\"!../../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nimport __vue_script__ from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./app.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-2e1372de\\\",\\\"hasScoped\\\":true,\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../node_modules/vue-loader/lib/selector?type=template&index=0!./app.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-2e1372de\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/pages/pagebuild/app.vue\n// module id = null\n// module chunks = ","\r\n\r\n\r\nexport default {\r\n    name: 'tool-bar',\r\n    data(){\r\n        return {\r\n\r\n        }\r\n    },\r\n    mounted(){\r\n\r\n    },\r\n    methods: {\r\n        showAuthDialog(){\r\n            var event = new CustomEvent('freelogService', {detail: {\r\n                action: 'showAuthDialog'\r\n            }});\r\n            window.dispatchEvent(event)\r\n        }\r\n    }\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/pages/pagebuild/toolbar/index.js","<template>\r\n    <ul class=\"tool-bar-wrap\">\r\n        <li class=\"user-tab\" title=\"个人中心\"><a href=\"/pages/user/index.html\" target=\"_blank\"><i class=\"el-icon-fa-user\" aria-hidden=\"true\"></i></a></li>\r\n        <li class=\"contract-tab\" @click=\"showAuthDialog\" title=\"合同管理\"><i class=\"el-icon-document\"></i></li>\r\n    </ul>\r\n</template>\r\n\r\n<script>\r\n    import ToolBar from './index'\r\n    export default ToolBar\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n@import \"index.less\";\r\n\r\n</style>\n\n\n// WEBPACK FOOTER //\n// src/pages/pagebuild/toolbar/index.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('ul',{staticClass:\"tool-bar-wrap\"},[_vm._m(0,false,false),_vm._v(\" \"),_c('li',{staticClass:\"contract-tab\",attrs:{\"title\":\"合同管理\"},on:{\"click\":_vm.showAuthDialog}},[_c('i',{staticClass:\"el-icon-document\"})])])}\nvar staticRenderFns = [function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('li',{staticClass:\"user-tab\",attrs:{\"title\":\"个人中心\"}},[_c('a',{attrs:{\"href\":\"/pages/user/index.html\",\"target\":\"_blank\"}},[_c('i',{staticClass:\"el-icon-fa-user\",attrs:{\"aria-hidden\":\"true\"}})])])}]\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-562dac57\",\"hasScoped\":true,\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/pages/pagebuild/toolbar/index.vue\n// module id = null\n// module chunks = ","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{attrs:{\"id\":\"app\"}},[_c('tool-bar'),_vm._v(\" \"),_c('el-dialog',{attrs:{\"close-on-click-modal\":false,\"title\":\"签约\",\"visible\":_vm.shouldShowAuthDialog,\"fullscreen\":false,\"custom-class\":\"auth-dialog\",\"width\":\"50%\",\"center\":\"\"},on:{\"update:visible\":function($event){_vm.shouldShowAuthDialog=$event}}},[_c('el-tabs',{attrs:{\"type\":\"border-card\",\"value\":\"contract\"}},[_c('el-tab-pane',{attrs:{\"label\":\"签约合同\"}},[_c('el-table',{ref:\"policyTable\",staticStyle:{\"width\":\"100%\"},attrs:{\"data\":_vm.policies,\"stripe\":\"\"}},[_c('el-table-column',{attrs:{\"type\":\"expand\"},scopedSlots:_vm._u([{key:\"default\",fn:function(scope){return [_c('ul',_vm._l((scope.row.segments),function(segment){return _c('li',{staticClass:\"segment-row\"},[_c('span',{staticClass:\"segment-detail\"},[_vm._v(\"合同ID \"+_vm._s(segment.detail.segmentId))]),_vm._v(\" \"),_c('el-radio',{staticClass:\"select-btn\",attrs:{\"label\":segment.detail.segmentId},model:{value:(scope.row.selectedSegmentId),callback:function ($$v) {_vm.$set(scope.row, \"selectedSegmentId\", $$v)},expression:\"scope.row.selectedSegmentId\"}},[_vm._v(\"选择\\n                                    \")])],1)}))]}}])}),_vm._v(\" \"),_c('el-table-column',{attrs:{\"label\":\"合同名称\",\"prop\":\"name\"}}),_vm._v(\" \"),_c('el-table-column',{attrs:{\"label\":\"资源名称\",\"prop\":\"tagInfo.resourceInfo.resourceName\"}}),_vm._v(\" \"),_c('el-table-column',{attrs:{\"label\":\"资源类型\",\"prop\":\"tagInfo.resourceInfo.resourceType\",\"width\":\"120px\"}}),_vm._v(\" \"),_c('el-table-column',{attrs:{\"label\":\"操作\",\"align\":\"center\",\"width\":\"120px\"},scopedSlots:_vm._u([{key:\"default\",fn:function(scope){return [_c('el-button',{directives:[{name:\"show\",rawName:\"v-show\",value:(!!scope.row.selectedSegmentId),expression:\"!!scope.row.selectedSegmentId\"}],attrs:{\"size\":\"mini\"},on:{\"click\":function($event){_vm.signPolicyHandler(scope.row, scope.$index)}}},[_vm._v(\"\\n                                签约\\n                            \")]),_vm._v(\" \"),_c('el-button',{directives:[{name:\"show\",rawName:\"v-show\",value:(!scope.row.selectedSegmentId),expression:\"!scope.row.selectedSegmentId\"}],attrs:{\"size\":\"mini\"},on:{\"click\":function($event){_vm.showPolicyDetailHandler(scope.row, scope.$index)}}},[_vm._v(\"\\n                                查看合同\\n                            \")])]}}])})],1)],1),_vm._v(\" \"),_c('el-tab-pane',{attrs:{\"label\":\"合同管理\",\"name\":\"contract\"}},[_c('el-table',{ref:\"contractTable\",staticStyle:{\"width\":\"100%\"},attrs:{\"stripe\":\"\",\"data\":_vm.contracts}},[_c('el-table-column',{attrs:{\"type\":\"expand\"},scopedSlots:_vm._u([{key:\"default\",fn:function(scope){return [_c('h3',{staticClass:\"contract-title\"},[_vm._v(\"合同流程\")]),_vm._v(\" \"),_c('ul',{staticClass:\"state-steps\"},_vm._l((_vm.resolveStateTree(scope.row.statesData.stateTreeRoot)),function(state,index){return _c('li',{staticClass:\"state-step\",class:[\n                                _vm.getStateClass(state)\n                                ]},[_c('div',{staticClass:\"state-main\"},[_c('div',{staticClass:\"state-title\"},[(state.state)?_c('span',[_vm._v(\"\\n                                                \"+_vm._s(state.state)+\" \"),_c('i',{staticClass:\"dot\"})]):(state.isWait)?_c('div',{staticClass:\"wait-state\"},[_c('i',{staticClass:\"el-icon-more\"})]):_vm._e()]),_vm._v(\" \"),_c('div',{staticClass:\"state-step-arrow\"},[(state.isMore)?_c('el-select',{attrs:{\"size\":\"mini\",\"placeholder\":\"请选择\"},model:{value:(state.selected),callback:function ($$v) {_vm.$set(state, \"selected\", $$v)},expression:\"state.selected\"}},_vm._l((state.nextStates),function(next,nextIndex){return _c('el-option',{key:\"\",attrs:{\"label\":next.state,\"value\":next.state}},[_c('span',{staticStyle:{\"float\":\"left\"}},[_vm._v(_vm._s(next.state))]),_vm._v(\" \"),_c('span',{staticStyle:{\"float\":\"right\",\"color\":\"#8492a6\",\"font-size\":\"13px\"},on:{\"click\":function($event){_vm.activateContractHandler(scope.row, state, next, nextIndex)}}},[_vm._v(\"trigger\")])])})):(state.isProcess)?_c('el-button',{attrs:{\"size\":\"mini\"},on:{\"click\":function($event){_vm.activateContractHandler(scope.row, state)}}},[_vm._v(\"trigger\"),_c('i',{staticClass:\"el-icon-arrow-right\"})]):_vm._e(),_vm._v(\" \"),_c('i',{staticClass:\"el-icon-arrow-right\"})],1)])])}))]}}])}),_vm._v(\" \"),_c('el-table-column',{attrs:{\"label\":\"合同ID\",\"prop\":\"contractId\",\"width\":\"240px\"}}),_vm._v(\" \"),_c('el-table-column',{attrs:{\"label\":\"资源名称\",\"prop\":\"resourceDetail.resourceName\"}}),_vm._v(\" \"),_c('el-table-column',{attrs:{\"label\":\"资源类型\",\"prop\":\"resourceDetail.resourceType\",\"width\":\"120px\"}}),_vm._v(\" \"),_c('el-table-column',{attrs:{\"label\":\"操作\",\"align\":\"center\",\"width\":\"150px\"},scopedSlots:_vm._u([{key:\"default\",fn:function(scope){return [_c('el-button',{attrs:{\"size\":\"mini\"},on:{\"click\":function($event){_vm.showContractDetailHandler(scope.row, scope.$index)}}},[_vm._v(\"\\n                                查看合同流程\\n                            \")])]}}])})],1)],1)],1)],1)],1)}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-2e1372de\",\"hasScoped\":true,\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/pages/pagebuild/app.vue\n// module id = null\n// module chunks = ","import Vue from '@/layout'\r\n\r\nimport App from './app.vue'\r\n\r\nwindow.QI = document.querySelector('.js-lib-qi');\r\n\r\nnew Vue({\r\n    el: '#app',\r\n    render: h => h(App)\r\n})\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/pagebuild/app.js"],"sourceRoot":""}