{"version":3,"sources":["webpack:///pages/pagebuild/demo.315234cd3c51880a20e2.js","webpack:///./src/pages/pagebuild/exception_code.js","webpack:///./src/pages/pagebuild/service/errorResponseHandler.js","webpack:///./src/pages/pagebuild/service/index.js","webpack:///./src/pages/pagebuild/event-dispatcher.js","webpack:///./src/pages/pagebuild/demo/app.js","webpack:///./src/components/toolbar/index.vue","webpack:///./src/components/toolbar/index.js","webpack:///src/components/toolbar/index.vue","webpack:///./src/components/toolbar/index.vue?8af2","webpack:///./src/pages/pagebuild/ui-lib/contract-state/direct-graph.js","webpack:///./src/pages/pagebuild/ui-lib/contract-state/index.js","webpack:///./src/pages/pagebuild/ui-lib/contract-state/index.vue","webpack:///./src/pages/pagebuild/ui-lib/contract/index.vue","webpack:///./src/pages/pagebuild/app.vue","webpack:///src/pages/pagebuild/ui-lib/contract-state/index.vue","webpack:///./src/pages/pagebuild/ui-lib/contract-state/index.vue?b130","webpack:///./src/pages/pagebuild/ui-lib/config.js","webpack:///./src/pages/pagebuild/ui-lib/presentables/index.js","webpack:///src/pages/pagebuild/ui-lib/presentables/index.vue","webpack:///./src/pages/pagebuild/ui-lib/presentables/index.vue?e05d","webpack:///./src/pages/pagebuild/ui-lib/presentables/index.vue","webpack:///./src/pages/pagebuild/ui-lib/contract/index.js","webpack:///src/pages/pagebuild/ui-lib/contract/index.vue","webpack:///./src/pages/pagebuild/ui-lib/contract/index.vue?f42c","webpack:///./src/pages/pagebuild/ui-lib/policy/index.js","webpack:///src/pages/pagebuild/ui-lib/policy/index.vue","webpack:///./src/pages/pagebuild/ui-lib/policy/index.vue?fdfa","webpack:///./src/pages/pagebuild/ui-lib/policy/index.vue","webpack:///src/pages/pagebuild/app.vue","webpack:///./src/pages/pagebuild/app.vue?4d6d","webpack:///./src/pages/pagebuild/parser.js"],"names":["webpackJsonp","8Yzw","module","exports","__webpack_require__","UHGq","__webpack_exports__","Object","defineProperty","value","layout","app","parser","EventCode","invalidResponse","exception_code","vue_esm","dataloaderHelpers","loadResourceDetail","resourceId","window","QI","fetch","then","res","status","json","Promise","reject","ret","errcode","data","loadPresentableDetail","presentableId","loadContractDetail","contractData","contract","this","targetId","resourceDetail","tagInfo","resourceInfo","contractDetail","loadPolicyDetail","authData","errorResponseHandler","name","handle","appUI","callback","$on","console","log","errorMsg","msg","resData","appendDataToUI","bind","appendData","showAuthDialog","service","event_dispatcher","init","bus","dispatchHandler","event","Handler","detail","handlerName","eventName","opts","warn","trigger","$emit","App","isValidResponse","apply","arguments","document","querySelector","el","template","components","app-view","methods","onReady","FreeLogApp","start","aXzh","bKTp","injectStyle","ssrContext","toolbar","mounted","CustomEvent","action","dispatchEvent","components_toolbar","render","_vm","_h","$createElement","_c","_self","staticClass","_m","_v","attrs","title","on","click","staticRenderFns","href","target","aria-hidden","esExports","selectortype_template_index_0_src_components_toolbar","normalizeComponent","__vue_styles__","Component","brKg","lioW","DirectGraph","tick","path","attr","d","deltaX","x","source","deltaY","y","dist","Math","sqrt","normX","normY","sourcePadding","left","targetPadding","right","circle","restart","links","style","enter","append","stateClass","p","src","pos","d3","mouse","$tip","opacity","top","self","_opts","overlayHandler","innerHTML","JSON","stringify","state","exit","remove","nodes","id","selectAll","classed","reflexive","g","Radius","text","force","$svg","width","height","scale","category10","radius","$container","container","select","parentNode","createElement","classList","add","appendChild","size","linkDistance","charge","forEach","node","push","link","createNode","props","lastNodeId","assign","formatNodes","nodeList","nodeMap","nodeArr","index","resolveStateClass","tmp","nextStates","next","generateRoot","stateTreeRoot","children","stateCls","isProcess","isFinish","isWaiting","isActive","setTreeNodePosition","result","root","tree","keys","stateNode","stateMap","key","parseContract","initStateNode","stateName","targetEvents","activatedStates","includes","curState","deep","walkTree","length","nextNode","nextStateNode","nextState","fsmState","policySegment","descs","fsmDescription","initialState","desc","curStateNode","currentState","contract_injectStyle","app_injectStyle","direct_graph","contract_state","type","default","popData","disabled","indexOf","triggerEvents","filter","$refs","popover","showPopper","getComputedStyle","wrapper","stateTree","parseInt","draw","updateContractState","isActivated","triggerLicense","method","triggerContractState","activateContractHandler","triggerHandler","promise","contractId","eventId","licenseIds","params","resolve","$message","success","error","hidePopover","nodeName","$el","contains","stopPropagation","resolveData","update","ui_lib_contract_state","ref","popper-class","placement","directives","rawName","expression","_s","undefined","$event","_e","pagebuild_ui_lib_contract_state","pages_pagebuild_ui_lib_contract_state","CONTRACT_STATUS","uncreated","initial","running","activated","userTerminated","sysTerminated","terminated","CONTRACT_STATUS_TIPS","-1","1","2","3","4","5","6","presentables","CONTRACT_STATUS_ACTION_TIPS","Array","formatPresentableList","watch","presentable","resovlePresentableStatus","contractStatus","statusTip","tabActionHandler","tabConfig","content","showPolicyDetailHandler","ui_lib_presentables","presentables_render","staticStyle","stripe","label","prop","align","scopedSlots","_u","fn","scope","row","$index","presentables_staticRenderFns","presentables_esExports","pagebuild_ui_lib_presentables","presentables_normalizeComponent","presentables_Component","pages_pagebuild_ui_lib_presentables","ContractState","showContractDetailHandler","ui_lib_contract","contract_render","resourceName","resourceType","contract_staticRenderFns","contract_esExports","pagebuild_ui_lib_contract","contract_normalizeComponent","contract___vue_styles__","contract_Component","pages_pagebuild_ui_lib_contract","policy","formatPolicy","parsePolicy","segments","block","segment","states","selected","$set","signPolicyHandler","policyData","selectedSegmentId","warning","tip","$confirm","confirmButtonText","cancelButtonText","dangerouslyUseHTMLString","contractType","segmentId","serialNumber","partyTwo","__auth_info__","__auth_user_id__","catch","ui_lib_policy","policy_render","_l","model","$$v","policy_staticRenderFns","policy_esExports","pagebuild_ui_lib_policy","policy_normalizeComponent","policy_Component","pages_pagebuild_ui_lib_policy","shouldShowAuthDialog","tabs","activeTabName","ToolBar","Presentables","contract-manager","policy-manager","_tabChange","some","tab","_removeTab","targetName","_this","activeName","nextTab","t","_closeDialogHandler","app_render","close-on-click-modal","visible","fullscreen","custom-class","center","update:visible","close","tab-remove","tabChange","item","closable","tag","app_staticRenderFns","app_esExports","pagebuild_app","app_normalizeComponent","app___vue_styles__","app_Component","qsBO","importHtml","onload","onerror","rel","head","authInfo","authErrorData","__auth_error_info__","ExceptionCode","loadWidgets","getWidgets","querySelectorAll","$widgets","url","__auth_node_id__","from","widget","prensentableId","getAttribute","fetchPresentable","err","yfD/"],"mappings":"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","file":"pages\\pagebuild\\demo.315234cd3c51880a20e2.js","sourcesContent":["webpackJsonp([2],{\n\n/***/ \"8Yzw\":\n/***/ (function(module, exports, __webpack_require__) {\n\n// removed by extract-text-webpack-plugin\n    if(false) {\n      // 1513237844439\n      var cssReload = require(\"../../../node_modules/css-hot-loader/hotModuleReplacement.js\")(module.id, {\"fileMap\":\"{fileName}\"});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  \n\n/***/ }),\n\n/***/ \"UHGq\":\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\nObject.defineProperty(__webpack_exports__, \"__esModule\", { value: true });\n\n// EXTERNAL MODULE: ./src/layout.js + 1 modules\nvar layout = __webpack_require__(\"rA12\");\n\n// EXTERNAL MODULE: ./src/pages/pagebuild/app.vue + 20 modules\nvar app = __webpack_require__(\"lioW\");\n\n// EXTERNAL MODULE: ./src/pages/pagebuild/parser.js\nvar parser = __webpack_require__(\"qsBO\");\n\n// CONCATENATED MODULE: ./src/pages/pagebuild/exception_code.js\n//异常对应的handler函数名\nvar EventCode = {\n    invalidResponse: 'errorResponseHandler'\n};\n\n/* harmony default export */ var exception_code = (EventCode);\n// EXTERNAL MODULE: ./node_modules/vue/dist/vue.esm.js\nvar vue_esm = __webpack_require__(\"7+uW\");\n\n// CONCATENATED MODULE: ./src/pages/pagebuild/service/errorResponseHandler.js\nvar dataloaderHelpers = {\n    loadResourceDetail: function loadResourceDetail(resourceId) {\n        return window.QI.fetch('//api.freelog.com/v1/resources/' + resourceId).then(function (res) {\n            if (res.status === 200) {\n                return res.json();\n            } else {\n                return Promise.reject(res);\n            }\n        }).then(function (res) {\n            if (res.ret === 0 && res.errcode === 0) {\n                return res.data;\n            } else {\n                return Promise.reject(res);\n            }\n        });\n    },\n    loadPresentableDetail: function loadPresentableDetail(presentableId) {\n        return window.QI.fetch('//api.freelog.com/v1/presentables/' + presentableId).then(function (res) {\n            if (res.status === 200) {\n                return res.json();\n            } else {\n                return Promise.reject(res);\n            }\n        }).then(function (res) {\n            if (res.ret === 0 && res.errcode === 0) {\n                return res.data;\n            } else {\n                return Promise.reject(res);\n            }\n        });\n    },\n    loadContractDetail: function loadContractDetail(data) {\n        var contractData = data.contract;\n        return this.loadPresentableDetail(contractData.targetId).then(function (data) {\n            contractData.resourceDetail = data.tagInfo.resourceInfo;\n            data.contractDetail = contractData;\n            data.resourceDetail = data.tagInfo.resourceInfo;\n            return data;\n        });\n    },\n    loadPolicyDetail: function loadPolicyDetail(authData) {\n        var presentableId = authData.presentableId;\n        return this.loadPresentableDetail(presentableId).then(function (data) {\n            data.resourceDetail = data.tagInfo.resourceInfo;\n            return data;\n        });\n    }\n};\n\n/* harmony default export */ var errorResponseHandler = ({\n    name: 'errorResponseHandler',\n    handle: function handle(data, appUI, callback) {\n        this.appUI = appUI;\n\n        if (typeof callback === 'function') {\n            appUI.$on('close', function () {\n                //todo\n                console.log('error response close');\n            });\n        }\n\n        if (data && data.errcode) {\n            var errorMsg = data.msg;\n            var resData = data.data && data.data.data;\n            switch (data.errcode) {\n                //未激活状态\n                case 70080104:\n                    dataloaderHelpers.loadContractDetail(resData).then(this.appendDataToUI.bind(this));\n                    break;\n                //未签约状态\n                case 70080101:\n                    dataloaderHelpers.loadPolicyDetail(resData).then(this.appendDataToUI.bind(this));\n                    break;\n                //节点与资源之间的合约授权失败\n                case 70080202:\n                    console.log(errorMsg, resData);\n                    break;\n                default:\n                    break;\n            }\n        }\n    },\n    appendDataToUI: function appendDataToUI(data) {\n        this.appUI.appendData(data);\n        this.appUI.showAuthDialog();\n    }\n});\n// CONCATENATED MODULE: ./src/pages/pagebuild/service/index.js\n\n\n/* harmony default export */ var service = ({\n    errorResponseHandler: errorResponseHandler\n});\n// CONCATENATED MODULE: ./src/pages/pagebuild/event-dispatcher.js\n\n\n\nvar DEFAULT_EVENT_NAME = 'freelogSystemService';\n\n/* harmony default export */ var event_dispatcher = ({\n    init: function init(appUI) {\n        this.appUI = appUI;\n        this.bus = new vue_esm[\"default\"]();\n        //统一监听服务，根据action进行分发执行器\n        this.bus.$on(DEFAULT_EVENT_NAME, this.dispatchHandler.bind(this));\n    },\n    dispatchHandler: function dispatchHandler(event) {\n        var detail = event.detail;\n        var handlerName = detail.eventName;\n        var opts = detail.opts;\n        var Handler;\n        if (Handler = service[handlerName]) {\n            Handler.handle(opts.data, this.appUI, opts.callback);\n        } else {\n            console.warn('不存在对应的异常处理函数');\n        }\n    },\n    trigger: function trigger(eventName, opts) {\n        this.bus.$emit(DEFAULT_EVENT_NAME, {\n            detail: {\n                eventName: eventName,\n                opts: opts\n            }\n        });\n    }\n});\n// CONCATENATED MODULE: ./src/pages/pagebuild/demo/app.js\n\n\n\n\n\n\n\n\n//对外接口服务\nvar App = {\n    isValidResponse: function isValidResponse(res) {\n        return res && res.ret === 0 && res.errcode === 0;\n    },\n    trigger: function trigger() {\n        event_dispatcher.trigger.apply(event_dispatcher, arguments);\n    },\n\n    EventCode: exception_code\n};\n\nfunction main() {\n    window.QI = document.querySelector('.js-lib-qi');\n\n    //render app view\n    new layout[\"a\" /* default */]({\n        el: '#app',\n        template: '<app-view @ready=\"onReady\"/>',\n        components: { 'app-view': app[\"a\" /* default */] },\n        methods: {\n            onReady: function onReady(appUI) {\n                //挂载UI\n                this.appUI = appUI;\n                window.FreeLogApp = App;\n                event_dispatcher.init(appUI);\n                parser[\"a\" /* default */].start();\n                appUI.$on('close', function () {\n                    console.log('close app ui dialog');\n                });\n            }\n        }\n    });\n}\n\nmain();\n\n/* harmony default export */ var demo_app = __webpack_exports__[\"default\"] = (App);\n\n/***/ }),\n\n/***/ \"aXzh\":\n/***/ (function(module, exports, __webpack_require__) {\n\n// removed by extract-text-webpack-plugin\n    if(false) {\n      // 1513237844449\n      var cssReload = require(\"../../../../../node_modules/css-hot-loader/hotModuleReplacement.js\")(module.id, {\"fileMap\":\"{fileName}\"});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  \n\n/***/ }),\n\n/***/ \"bKTp\":\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n\n// CONCATENATED MODULE: ./src/components/toolbar/index.js\n/* harmony default export */ var toolbar = ({\n    name: 'tool-bar',\n    data: function data() {\n        return {};\n    },\n    mounted: function mounted() {},\n\n    methods: {\n        showAuthDialog: function showAuthDialog() {\n            var event = new CustomEvent('freelogService', {\n                detail: {\n                    action: 'showAuthDialog'\n                }\n            });\n            window.dispatchEvent(event);\n        }\n    }\n});\n// CONCATENATED MODULE: ./node_modules/babel-loader/lib!./node_modules/vue-loader/lib/selector.js?type=script&index=0!./src/components/toolbar/index.vue\n//\n//\n//\n//\n//\n//\n//\n\n\n/* harmony default export */ var components_toolbar = (toolbar);\n// CONCATENATED MODULE: ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-562dac57\",\"hasScoped\":true,\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/components/toolbar/index.vue\nvar render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('ul',{staticClass:\"tool-bar-wrap\"},[_vm._m(0,false,false),_vm._v(\" \"),_c('li',{staticClass:\"contract-tab\",attrs:{\"title\":\"合同管理\"},on:{\"click\":_vm.showAuthDialog}},[_c('i',{staticClass:\"el-icon-document\"})])])}\nvar staticRenderFns = [function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('li',{staticClass:\"user-tab\",attrs:{\"title\":\"个人中心\"}},[_c('a',{attrs:{\"href\":\"/pages/user/index.html\",\"target\":\"_blank\"}},[_c('i',{staticClass:\"el-icon-fa-user\",attrs:{\"aria-hidden\":\"true\"}})])])}]\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\n/* harmony default export */ var selectortype_template_index_0_src_components_toolbar = (esExports);\n// CONCATENATED MODULE: ./src/components/toolbar/index.vue\nfunction injectStyle (ssrContext) {\n  __webpack_require__(\"brKg\")\n}\nvar normalizeComponent = __webpack_require__(\"VU/8\")\n/* script */\n\n/* template */\n\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-562dac57\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  components_toolbar,\n  selectortype_template_index_0_src_components_toolbar,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\n/* harmony default export */ var src_components_toolbar = __webpack_exports__[\"a\"] = (Component.exports);\n\n\n/***/ }),\n\n/***/ \"brKg\":\n/***/ (function(module, exports, __webpack_require__) {\n\n// removed by extract-text-webpack-plugin\n    if(false) {\n      // 1513237844444\n      var cssReload = require(\"../../../node_modules/css-hot-loader/hotModuleReplacement.js\")(module.id, {\"fileMap\":\"{fileName}\"});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  \n\n/***/ }),\n\n/***/ \"lioW\":\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n\n// EXTERNAL MODULE: ./src/components/toolbar/index.vue + 3 modules\nvar toolbar = __webpack_require__(\"bKTp\");\n\n// CONCATENATED MODULE: ./src/pages/pagebuild/ui-lib/contract-state/direct-graph.js\n//https://stackoverflow.com/questions/16058073/how-do-i-draw-a-graph-or-tree-structure-in-javascript\n//http://bl.ocks.org/rkirsling/5001347\n// https://bl.ocks.org/cjrd/6863459\n//https://bl.ocks.org/curran/5905182da50a4667dc00\n// https://bl.ocks.org/mbostock/1138500\nfunction DirectGraph(opts) {\n    opts = opts || {};\n    var width = opts.width || 960,\n        height = opts.height || 500,\n        colors = d3.scale.category10();\n    var Radius = opts.radius || 20;\n\n    var self = this;\n    var $svg;\n    var $container = typeof opts.container === 'string' ? document.querySelector(opts.container) : opts.container;\n    this._opts = opts;\n\n    if (opts.container) {\n        $svg = d3.select(opts.container);\n    } else {\n        $svg = d3.select(\"body\").append(\"svg\");\n    }\n    $svg.attr('width', width).attr('height', height);\n\n    var $tip = $container.parentNode.querySelector('.js-svg-tip');\n    if (!$tip) {\n        $tip = document.createElement('div');\n        $tip.classList.add('tip');\n        $container.parentNode.appendChild($tip);\n    }\n    var nodes = [];\n    var links = [];\n\n    // init D3 force layout\n    var force = d3.layout.force().size([width, height]).linkDistance(150).charge(-500).on('tick', tick);\n\n    // define arrow markers for graph links\n    $svg.append('svg:defs').append('svg:marker').attr('id', 'end-arrow').attr('viewBox', '0 -5 10 10').attr('refX', 6).attr('markerWidth', 3).attr('markerHeight', 3).attr('orient', 'auto').append('svg:path').attr('d', 'M0,-5L10,0L0,5').attr('fill', '#000');\n\n    $svg.append('svg:defs').append('svg:marker').attr('id', 'start-arrow').attr('viewBox', '0 -5 10 10').attr('refX', 4).attr('markerWidth', 3).attr('markerHeight', 3).attr('orient', 'auto').append('svg:path').attr('d', 'M10,-5L0,0L10,5').attr('fill', '#000');\n\n    // handles to link and node element groups\n    var path = $svg.append('svg:g').selectAll('path'),\n        circle = $svg.append('svg:g').selectAll('g');\n\n    // update force layout (called automatically each iteration)\n    function tick() {\n        // draw directed edges with proper padding from node centers\n        path.attr('d', function (d) {\n            var deltaX = d.target.x - d.source.x,\n                deltaY = d.target.y - d.source.y,\n                dist = Math.sqrt(deltaX * deltaX + deltaY * deltaY),\n                normX = deltaX / dist,\n                normY = deltaY / dist,\n                sourcePadding = d.left ? 17 : 12,\n                targetPadding = d.right ? 17 : 12,\n                sourceX = d.source.x + sourcePadding * normX,\n                sourceY = d.source.y + sourcePadding * normY,\n                targetX = d.target.x - targetPadding * normX,\n                targetY = d.target.y - targetPadding * normY;\n            return 'M' + sourceX + ',' + sourceY + 'L' + targetX + ',' + targetY;\n        });\n\n        circle.attr('transform', function (d) {\n            return 'translate(' + d.x + ',' + d.y + ')';\n        });\n    }\n\n    //selected变虚线\n    function restart() {\n        // path (link) group\n        path = path.data(links);\n\n        // update existing links\n        path.style('marker-start', function (d) {\n            return d.left ? 'url(#start-arrow)' : '';\n        }).style('marker-end', function (d) {\n            return d.right ? 'url(#end-arrow)' : '';\n        });\n\n        // add new links\n        path.enter().append('svg:path').attr('class', function (d) {\n            return d.target.data.stateClass + ' link';\n        }).style('marker-start', function (d) {\n            return d.left ? 'url(#start-arrow)' : '';\n        }).style('marker-end', function (d) {\n            return d.right ? 'url(#end-arrow)' : '';\n        }).on('mouseenter', function (p) {\n            var src = p.source;\n            var target = p.target;\n            var pos = d3.mouse(this);\n\n            $tip.style.opacity = 1;\n            $tip.style.top = pos[1] + 'px';\n            $tip.style.left = pos[0] + 'px';\n            if (self._opts.overlayHandler) {\n                self._opts.overlayHandler(p, $tip);\n            } else {\n                $tip.innerHTML = JSON.stringify({\n                    source: src.data.state,\n                    target: target.data.state\n                });\n            }\n        });\n\n        // remove old links\n        path.exit().remove();\n\n        // circle (node) group\n        // NB: the function arg is crucial here! nodes are known by id, not by index!\n        circle = circle.data(nodes, function (d) {\n            return d.id;\n        });\n\n        // update existing nodes (reflexive & selected visual states)\n        circle.selectAll('circle').classed('reflexive', function (d) {\n            return d.reflexive;\n        });\n\n        // add new nodes\n        var g = circle.enter().append('svg:g');\n        g.append('svg:circle').attr('class', function (d) {\n            return 'node ' + (d.data.stateClass || '');\n        }).attr('r', Radius).on('mouseenter', function (d) {\n            $tip.style.opacity = 1;\n            $tip.style.top = d.y - Radius + 'px';\n            $tip.style.left = d.x + Radius * 1.5 + 'px';\n            if (self._opts.overlayHandler) {\n                self._opts.overlayHandler(d.data, $tip);\n            } else {\n                $tip.innerHTML = JSON.stringify(d.data);\n            }\n        });\n\n        // show node IDs\n        g.append('svg:text').attr('x', 0).attr('y', 4).attr('class', 'id').text(function (d) {\n            // return d.data.state\n            return d.id;\n        });\n\n        // remove old nodes\n        circle.exit().remove();\n\n        // set the graph in motion\n        force.start();\n    }\n\n    opts.nodes.forEach(function (node) {\n        nodes.push(node);\n        restart();\n    });\n\n    opts.links.forEach(function (link) {\n        links.push(link);\n        restart();\n    });\n    return this;\n}\n\n/* harmony default export */ var direct_graph = (DirectGraph);\n// CONCATENATED MODULE: ./src/pages/pagebuild/ui-lib/contract-state/index.js\n\n\nvar lastNodeId = -1;\n\nfunction createNode(props, data) {\n    var node = { id: ++lastNodeId, reflexive: false, data: data };\n    Object.assign(node, props);\n    return node;\n}\n\n//创建渲染需要的数据结构\nfunction formatNodes(nodeList) {\n    var nodes = [];\n    var links = [];\n    var nodeMap = {};\n\n    nodeList.forEach(function (nodeArr, index) {\n        nodeArr.forEach(function (node) {\n            node.stateClass = resolveStateClass(node);\n            var tmp = createNode(node.pos, node);\n\n            nodeMap[node.state] = tmp;\n            nodes.push(tmp);\n        });\n    });\n\n    nodes.forEach(function (node) {\n        node.data.nextStates.forEach(function (next) {\n            links.push({\n                source: node,\n                target: nodeMap[next.state],\n                left: false,\n                right: true\n            });\n        });\n    });\n    return { nodes: nodes, links: links };\n}\n\n//生成d3 tree结构\nfunction generateRoot(stateTreeRoot) {\n    var node = {\n        name: stateTreeRoot.state,\n        children: []\n    };\n\n    stateTreeRoot.nextStates.forEach(function (next) {\n        node.children.push(generateRoot(next));\n    });\n\n    return node;\n}\n\nfunction resolveStateClass(state) {\n    var stateCls = 'is-disabled';\n    if (state.isProcess) {\n        stateCls = 'is-process';\n    } else if (state.isFinish) {\n        stateCls = 'is-finish';\n    } else if (state.isWaiting) {\n        stateCls = 'is-wait';\n    }\n\n    if (state.isActive) {\n        stateCls += ' is-active';\n    }\n    return stateCls;\n}\n\n//根据d3 tree生成的节点坐标设置force 节点的坐标\nfunction setTreeNodePosition(result, opts) {\n    var root = generateRoot(result.stateTreeRoot);\n    var height = opts.height;\n    var width = opts.width;\n    var tree = d3.layout.tree().size([height, width]);\n    var nodes = tree.nodes(root);\n    nodes.forEach(function (node) {\n        var keys = ['depth', 'x', 'y'];\n        var stateNode = result.stateMap[node.name];\n        if (stateNode) {\n            stateNode.pos = {};\n            keys.forEach(function (key) {\n                stateNode.pos[key] = node[key];\n            });\n            //将纵向变成横向\n            var x = stateNode.pos.x;\n            stateNode.pos.x = stateNode.pos.y;\n            stateNode.pos.y = x;\n        }\n    });\n}\n\nfunction parseContract(contractData) {\n    var curState = contractData.fsmState;\n    var policySegment = contractData.policySegment;\n    var descs = policySegment.fsmDescription;\n    var activatedStates = policySegment.activatedStates;\n    var initialState = policySegment.initialState;\n    var stateMap = {};\n    var stateTreeRoot;\n\n    function initStateNode(stateName) {\n        return {\n            nextStates: [],\n            targetEvents: [], //到下一状态可能的路径(事件)\n            state: stateName,\n            isActive: activatedStates.includes(stateName),\n            isProcess: stateName === curState,\n            deep: 0\n        };\n    }\n\n    var nodeList = []; //每层的节点列表\n\n    function walkTree(node) {\n        if (!nodeList[node.deep]) {\n            nodeList[node.deep] = [];\n        }\n        nodeList[node.deep].push(node);\n\n        if (!node.nextStates.length) {\n            return;\n        }\n\n        node.nextStates.forEach(function (nextNode) {\n            var nextStateNode = stateMap[nextNode.state];\n            nextStateNode.deep = node.deep + 1;\n\n            if (node.isProcess || node.isWaiting) {\n                nextStateNode.isWaiting = true;\n            }\n\n            if (nextStateNode.isProcess) {\n                node.isFinish = true;\n            }\n\n            if (nextStateNode.targetEvents.length) {\n                nextStateNode.targetEvents.forEach(function (event) {\n                    if (stateMap[event.nextState] && event.nextState !== node.state) {\n                        nextStateNode.nextStates.push(stateMap[event.nextState]);\n                    }\n                });\n            }\n            walkTree(nextStateNode);\n\n            if (nextStateNode.isFinish) {\n                node.isFinish = true;\n            }\n        });\n    }\n\n    descs.forEach(function (desc) {\n        var curStateNode = stateMap[desc.currentState] || initStateNode(desc.currentState);\n        var nextStateNode = stateMap[desc.nextState];\n\n        curStateNode.targetEvents.push(desc);\n\n        if (!nextStateNode) {\n            nextStateNode = initStateNode(desc.nextState);\n            stateMap[desc.nextState] = nextStateNode;\n        }\n\n        //标记根节点的next，便于初始化遍历\n        if (desc.currentState === initialState) {\n            curStateNode.nextStates.push(nextStateNode);\n        }\n        stateMap[desc.currentState] = curStateNode;\n    });\n\n    stateTreeRoot = stateMap[initialState];\n    walkTree(stateTreeRoot);\n\n    return { stateTreeRoot: stateTreeRoot, stateMap: stateMap, nodeList: nodeList };\n}\n\n/* harmony default export */ var contract_state = ({\n    name: 'contract-state',\n    props: {\n        data: {\n            type: Object,\n            default: function _default() {\n                return null;\n            }\n        }\n    },\n    data: function data() {\n        var self = this;\n        return {\n            popData: {},\n            opts: {\n                radius: 12,\n                width: 400,\n                height: 200,\n                container: null,\n                overlayHandler: function overlayHandler(data) {\n                    var popData = Object.assign({}, data);\n                    if (data.source) {\n                        popData.type = 'path';\n                        popData.disabled = data.target.data.stateClass.indexOf('is-disabled') > -1;\n                        var triggerEvents = data.source.data.targetEvents.filter(function (event) {\n                            return event.nextState === data.target.data.state;\n                        });\n                        popData.event = triggerEvents[0] && triggerEvents[0].event || {};\n                    } else {\n                        //node\n                        popData.type = 'node';\n                    }\n\n                    if (!popData.disabled) {\n                        self.popData = popData;\n                        self.$refs.popover.showPopper = true;\n                    }\n                }\n            }\n        };\n    },\n    mounted: function mounted() {\n        var style = getComputedStyle(this.$refs.wrapper);\n\n        this.opts.container = this.$refs.stateTree;\n        this.opts.width = parseInt(parseInt(style.width) * .8);\n        this.draw();\n    },\n\n    methods: {\n        updateContractState: function updateContractState(state) {\n            state.isProcess = true;\n            state.isActivated = true;\n        },\n        triggerLicense: function triggerLicense(data) {\n            return window.QI.fetch('//api.freelog.com/v1/contracts/signingLicenses', {\n                method: 'POST',\n                data: data\n            }).then(function (res) {\n                return res.json();\n            });\n        },\n        triggerContractState: function triggerContractState(data) {\n            return window.QI.fetch('//api.freelog.com/v1/contracts/test', {\n                method: 'POST',\n                data: data\n            }).then(function (res) {\n                return res.json();\n            });\n        },\n        activateContractHandler: function activateContractHandler(data) {\n            var self = this;\n            var contract = self.data;\n            var contractId = contract.contractId;\n            var source = data.source.data;\n            var target = data.target.data;\n            var nextState = target.state;\n\n            var triggerEvents = source.targetEvents.filter(function (event) {\n                return event.nextState === nextState;\n            });\n\n            if (triggerEvents.length === 0) {\n                return self.$message.error('没有可触发的事件');\n            } else {\n                triggerEvents.forEach(function (trigger) {\n                    if (trigger.event.type === 'compoundEvents') {\n                        trigger.event.params.forEach(function (event) {\n                            triggerHandler(event);\n                        });\n                    } else {\n                        triggerHandler(trigger.event);\n                    }\n                });\n            }\n\n            function triggerHandler(event) {\n                var promise;\n                if (event.type === 'signing') {\n                    promise = self.triggerLicense({\n                        contractId: contractId,\n                        eventId: event.eventId,\n                        licenseIds: event.params\n                    });\n                } else {\n                    promise = self.triggerContractState({\n                        contractId: contractId,\n                        eventId: event.eventId\n                    });\n                }\n\n                Promise.resolve(promise).then(function (data) {\n                    if (data.ret === 0 && data.errcode === 0) {\n                        self.$message.success('操作成功');\n                        self.updateContractState(contract, nextState);\n                    } else {\n                        self.$message.error(data.msg);\n                    }\n                });\n            }\n        },\n        hidePopover: function hidePopover(event) {\n            if (['circle', 'path'].includes(event.target.nodeName) || this.$refs.popover.$el.contains(event.target)) {\n                event.stopPropagation();\n            } else {\n                this.$refs.popover.showPopper = false;\n            }\n        },\n        draw: function draw() {\n            if (!this.data.contractId) {\n                return;\n            }\n            var result = parseContract(this.data);\n            setTreeNodePosition(result, this.opts);\n            var resolveData = formatNodes(result.nodeList);\n            Object.assign(this.opts, resolveData);\n            new direct_graph(this.opts);\n        },\n        update: function update(data) {\n            this.data = data;\n            this.draw();\n        }\n    }\n});\n// CONCATENATED MODULE: ./node_modules/babel-loader/lib!./node_modules/vue-loader/lib/selector.js?type=script&index=0!./src/pages/pagebuild/ui-lib/contract-state/index.vue\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\n\n\n/* harmony default export */ var ui_lib_contract_state = (contract_state);\n// CONCATENATED MODULE: ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-0b962c39\",\"hasScoped\":false,\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/pages/pagebuild/ui-lib/contract-state/index.vue\nvar render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{ref:\"wrapper\",staticClass:\"contract-state-wrap\",on:{\"click\":_vm.hidePopover}},[_c('el-popover',{ref:\"popover\",attrs:{\"popper-class\":\"tip js-svg-tip\",\"placement\":\"top\",\"trigger\":\"click\",\"width\":\"250\"}},[_c('div',[_c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.popData.type == 'node'),expression:\"popData.type == 'node'\"}]},[_c('h3',[_vm._v(\"state:\"+_vm._s(_vm.popData.state))]),_vm._v(\" \"),_c('ul',[_c('li',[_vm._v(\"isActiveState: \"+_vm._s(_vm.popData.isActive))]),_vm._v(\" \"),_c('li',[_vm._v(\"isProcess: \"+_vm._s(_vm.popData.isProcess))]),_vm._v(\" \"),_c('li',[_vm._v(\"isFinish: \"+_vm._s((_vm.popData.isFinish === undefined)? 'false': _vm.popData.isFinish))])])]),_vm._v(\" \"),(_vm.popData.type == 'path'&& _vm.popData.source)?_c('div',[_c('p',[_vm._v(\"event name: \"+_vm._s(_vm.popData.event.eventName))]),_vm._v(\" \"),_c('p',[_vm._v(\"from \"+_vm._s(_vm.popData.source.data.state)+\" to \"+_vm._s(_vm.popData.target.data.state))]),_vm._v(\" \"),_c('el-button',{attrs:{\"size\":\"mini\"},on:{\"click\":function($event){_vm.activateContractHandler(_vm.popData)}}},[_vm._v(\"trigger\")])],1):_vm._e()])]),_vm._v(\" \"),_c('svg',{ref:\"stateTree\"})],1)}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\n/* harmony default export */ var pagebuild_ui_lib_contract_state = (esExports);\n// CONCATENATED MODULE: ./src/pages/pagebuild/ui-lib/contract-state/index.vue\nfunction injectStyle (ssrContext) {\n  __webpack_require__(\"yfD/\")\n}\nvar normalizeComponent = __webpack_require__(\"VU/8\")\n/* script */\n\n/* template */\n\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = null\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  ui_lib_contract_state,\n  pagebuild_ui_lib_contract_state,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\n/* harmony default export */ var pages_pagebuild_ui_lib_contract_state = (Component.exports);\n\n// CONCATENATED MODULE: ./src/pages/pagebuild/ui-lib/config.js\nvar CONTRACT_STATUS = {\n    uncreated: -1,\n    initial: 1,\n    running: 2,\n    activated: 3,\n    userTerminated: 4,\n    sysTerminated: 5,\n    terminated: 6\n};\n\nvar CONTRACT_STATUS_TIPS = {\n    '-1': '未创建合同',\n    1: '未开始执行',\n    2: '执行中',\n    3: '生效中',\n    4: '用户终止',\n    5: '系统终止',\n    6: '合同已终止'\n};\n// CONCATENATED MODULE: ./src/pages/pagebuild/ui-lib/presentables/index.js\n\n\n/* harmony default export */ var presentables = ({\n    name: 'presentables',\n\n    data: function data() {\n        return {\n            CONTRACT_STATUS: CONTRACT_STATUS,\n            CONTRACT_STATUS_ACTION_TIPS: {\n                '-1': '去创建合同',\n                1: '去执行', //未开始执行\n                2: '去执行', //执行中\n                3: '生效中',\n                4: '用户终止',\n                5: '系统终止',\n                6: '合同已终止'\n            }\n        };\n    },\n\n    props: {\n        data: {\n            type: Array,\n            default: function _default() {\n                return null;\n            }\n        }\n    },\n    mounted: function mounted() {\n        this.formatPresentableList();\n        console.log(this.data);\n    },\n\n    watch: {\n        data: 'formatPresentableList'\n    },\n    methods: {\n        formatPresentableList: function formatPresentableList() {\n            var self = this;\n            var presentables = self.data;\n            presentables.forEach(function (presentable) {\n                self.resovlePresentableStatus(presentable);\n            });\n        },\n        resovlePresentableStatus: function resovlePresentableStatus(presentable) {\n            if (presentable.contractDetail) {\n                presentable.contractStatus = presentable.contractDetail.status;\n            } else {\n                presentable.contractStatus = CONTRACT_STATUS.uncreated;\n            }\n\n            presentable.statusTip = CONTRACT_STATUS_TIPS[presentable.contractStatus] || 'n/a';\n        },\n        tabActionHandler: function tabActionHandler(presentable) {\n            var tabConfig = {\n                content: 'contract-manager',\n                data: presentable,\n                title: '合同管理',\n                name: 'tab' + presentable.presentableId\n            };\n\n            switch (presentable.contractStatus) {\n                case CONTRACT_STATUS.uncreated:\n                    Object.assign(tabConfig, {\n                        title: '创建合同',\n                        content: 'policy-manager'\n                    });\n                    break;\n                case CONTRACT_STATUS.initial:\n                    break;\n                case CONTRACT_STATUS.running:\n                    break;\n                case CONTRACT_STATUS.activated:\n                    break;\n                case CONTRACT_STATUS.userTerminated:\n                    break;\n                case CONTRACT_STATUS.sysTerminated:\n                    break;\n                case CONTRACT_STATUS.terminated:\n                    break;\n            }\n\n            this.$emit('tabChange', tabConfig); //自己监听自己，但是处理函数定义在父级元素\n            // this.$message.warning('todo')\n        },\n        showPolicyDetailHandler: function showPolicyDetailHandler() {}\n    }\n});\n// CONCATENATED MODULE: ./node_modules/babel-loader/lib!./node_modules/vue-loader/lib/selector.js?type=script&index=0!./src/pages/pagebuild/ui-lib/presentables/index.vue\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\n\n/* harmony default export */ var ui_lib_presentables = (presentables);\n// CONCATENATED MODULE: ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-7052f966\",\"hasScoped\":false,\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/pages/pagebuild/ui-lib/presentables/index.vue\nvar presentables_render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('el-table',{ref:\"tableRef\",staticStyle:{\"width\":\"100%\"},attrs:{\"data\":_vm.data,\"stripe\":\"\"}},[_c('el-table-column',{attrs:{\"label\":\"资源名称\",\"prop\":\"tagInfo.resourceInfo.resourceName\"}}),_vm._v(\" \"),_c('el-table-column',{attrs:{\"label\":\"合同名称\",\"prop\":\"name\"}}),_vm._v(\" \"),_c('el-table-column',{attrs:{\"label\":\"资源类型\",\"prop\":\"tagInfo.resourceInfo.resourceType\",\"width\":\"120px\"}}),_vm._v(\" \"),_c('el-table-column',{attrs:{\"label\":\"状态\",\"prop\":\"statusTip\"}}),_vm._v(\" \"),_c('el-table-column',{attrs:{\"label\":\"操作\",\"align\":\"center\",\"width\":\"120px\"},scopedSlots:_vm._u([{key:\"default\",fn:function(scope){return [_c('el-button',{attrs:{\"size\":\"mini\"},on:{\"click\":function($event){_vm.tabActionHandler(scope.row, scope.$index)}}},[_vm._v(\"\\n                    \"+_vm._s(_vm.CONTRACT_STATUS_ACTION_TIPS[scope.row.contractStatus])+\"\\n                \")])]}}])})],1)],1)}\nvar presentables_staticRenderFns = []\nvar presentables_esExports = { render: presentables_render, staticRenderFns: presentables_staticRenderFns }\n/* harmony default export */ var pagebuild_ui_lib_presentables = (presentables_esExports);\n// CONCATENATED MODULE: ./src/pages/pagebuild/ui-lib/presentables/index.vue\nvar presentables_normalizeComponent = __webpack_require__(\"VU/8\")\n/* script */\n\n/* template */\n\n/* template functional */\nvar presentables___vue_template_functional__ = false\n/* styles */\nvar presentables___vue_styles__ = null\n/* scopeId */\nvar presentables___vue_scopeId__ = null\n/* moduleIdentifier (server only) */\nvar presentables___vue_module_identifier__ = null\nvar presentables_Component = presentables_normalizeComponent(\n  ui_lib_presentables,\n  pagebuild_ui_lib_presentables,\n  presentables___vue_template_functional__,\n  presentables___vue_styles__,\n  presentables___vue_scopeId__,\n  presentables___vue_module_identifier__\n)\n\n/* harmony default export */ var pages_pagebuild_ui_lib_presentables = (presentables_Component.exports);\n\n// CONCATENATED MODULE: ./src/pages/pagebuild/ui-lib/contract/index.js\n\n\n\n/* harmony default export */ var contract = ({\n    name: 'contract-manager',\n\n    data: function data() {\n        return {};\n    },\n\n    components: { ContractState: pages_pagebuild_ui_lib_contract_state },\n    props: {\n        data: {\n            type: Object,\n            default: function _default() {\n                return null;\n            }\n        }\n    },\n    mounted: function mounted() {\n        console.log(this.data);\n    },\n\n    methods: {\n        showContractDetailHandler: function showContractDetailHandler() {}\n    }\n});\n// CONCATENATED MODULE: ./node_modules/babel-loader/lib!./node_modules/vue-loader/lib/selector.js?type=script&index=0!./src/pages/pagebuild/ui-lib/contract/index.vue\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\n\n\n/* harmony default export */ var ui_lib_contract = (contract);\n// CONCATENATED MODULE: ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-bdfded6c\",\"hasScoped\":true,\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/pages/pagebuild/ui-lib/contract/index.vue\nvar contract_render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('ul',[_c('li',[_vm._v(\"\\n            资源名称: \"+_vm._s(_vm.data.resourceDetail.resourceName)+\"\\n        \")]),_vm._v(\" \"),_c('li',[_vm._v(\"\\n            资源类型: \"+_vm._s(_vm.data.resourceDetail.resourceType)+\"\\n        \")]),_vm._v(\" \"),_c('li',[_c('el-button',{attrs:{\"size\":\"mini\"},on:{\"click\":_vm.showContractDetailHandler}},[_vm._v(\"\\n                查看合同流程\\n            \")])],1),_vm._v(\" \"),_c('li',[_c('h3',{staticClass:\"contract-title\"},[_vm._v(\"合同流程\")]),_vm._v(\" \"),_c('contract-state',{staticClass:\"contract-state-chart\",attrs:{\"data\":_vm.data.contractDetail}})],1)])])}\nvar contract_staticRenderFns = []\nvar contract_esExports = { render: contract_render, staticRenderFns: contract_staticRenderFns }\n/* harmony default export */ var pagebuild_ui_lib_contract = (contract_esExports);\n// CONCATENATED MODULE: ./src/pages/pagebuild/ui-lib/contract/index.vue\nfunction contract_injectStyle (ssrContext) {\n  __webpack_require__(\"aXzh\")\n}\nvar contract_normalizeComponent = __webpack_require__(\"VU/8\")\n/* script */\n\n/* template */\n\n/* template functional */\nvar contract___vue_template_functional__ = false\n/* styles */\nvar contract___vue_styles__ = contract_injectStyle\n/* scopeId */\nvar contract___vue_scopeId__ = \"data-v-bdfded6c\"\n/* moduleIdentifier (server only) */\nvar contract___vue_module_identifier__ = null\nvar contract_Component = contract_normalizeComponent(\n  ui_lib_contract,\n  pagebuild_ui_lib_contract,\n  contract___vue_template_functional__,\n  contract___vue_styles__,\n  contract___vue_scopeId__,\n  contract___vue_module_identifier__\n)\n\n/* harmony default export */ var pages_pagebuild_ui_lib_contract = (contract_Component.exports);\n\n// CONCATENATED MODULE: ./src/pages/pagebuild/ui-lib/policy/index.js\n/* harmony default export */ var policy = ({\n    name: 'policy-manager',\n\n    data: function data() {\n        return {};\n    },\n\n    props: {\n        data: {\n            type: Object,\n            default: function _default() {\n                return null;\n            }\n        }\n    },\n    watch: {\n        data: 'formatPolicy'\n    },\n\n    mounted: function mounted() {\n        this.formatPolicy();\n    },\n\n    methods: {\n        formatPolicy: function formatPolicy() {\n            this.parsePolicy(this.data);\n        },\n        parsePolicy: function parsePolicy(data) {\n            var segments = [];\n            data.policy.forEach(function (block) {\n                var segment = {\n                    detail: block,\n                    states: block.fsmDescription,\n                    selected: false\n                };\n\n                segments.push(segment);\n            });\n\n            this.$set(this.data, 'segments', segments);\n        },\n        signPolicyHandler: function signPolicyHandler(policyData) {\n            var self = this;\n            if (!policyData.selectedSegmentId) {\n                return this.$message.warning('没有选择策略');\n            }\n\n            var tip = 'presentable name: ' + policyData.name + ', resource name: ' + policyData.resourceDetail.resourceName;\n            this.$confirm('<h3>\\u5408\\u540C\\u8BE6\\u60C5</h3><p>' + tip + '\\u3002</p>\\u786E\\u5B9A\\u7B7E\\u7EA6\\u5408\\u540C\\uFF1F', '提示', {\n                confirmButtonText: '确定',\n                cancelButtonText: '取消',\n                dangerouslyUseHTMLString: true,\n                type: 'warning'\n            }).then(function () {\n                window.QI.fetch('//api.freelog.com/v1/contracts', {\n                    method: 'POST',\n                    data: {\n                        contractType: 3,\n                        targetId: policyData.presentableId,\n                        segmentId: policyData.selectedSegmentId,\n                        serialNumber: policyData.serialNumber,\n                        partyTwo: window.__auth_info__.__auth_user_id__\n                    }\n                }).then(function (res) {\n                    return res.json();\n                }).then(function (data) {\n                    if (data.ret === 0 && data.errcode === 0) {\n                        self.$message.success('签约成功');\n                    } else {\n                        self.$message.error(data.msg);\n                    }\n                });\n            }).catch(function () {\n                //取消\n            });\n        }\n    }\n});\n// CONCATENATED MODULE: ./node_modules/babel-loader/lib!./node_modules/vue-loader/lib/selector.js?type=script&index=0!./src/pages/pagebuild/ui-lib/policy/index.vue\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\n\n/* harmony default export */ var ui_lib_policy = (policy);\n// CONCATENATED MODULE: ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-64b12160\",\"hasScoped\":false,\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/pages/pagebuild/ui-lib/policy/index.vue\nvar policy_render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('ul',[_c('el-button',{on:{\"click\":_vm.signPolicyHandler}},[_vm._v(\"创建合同\")]),_vm._v(\" \"),_vm._l((_vm.data.segments),function(segment){return _c('li',{staticClass:\"segment-row\"},[_c('span',{staticClass:\"segment-detail\"},[_vm._v(\"合同ID \"+_vm._s(segment.detail.segmentId))]),_vm._v(\" \"),_c('el-radio',{staticClass:\"select-btn\",attrs:{\"label\":segment.detail.segmentId},model:{value:(_vm.data.selectedSegmentId),callback:function ($$v) {_vm.$set(_vm.data, \"selectedSegmentId\", $$v)},expression:\"data.selectedSegmentId\"}},[_vm._v(\"选择\\n            \")])],1)})],2)])}\nvar policy_staticRenderFns = []\nvar policy_esExports = { render: policy_render, staticRenderFns: policy_staticRenderFns }\n/* harmony default export */ var pagebuild_ui_lib_policy = (policy_esExports);\n// CONCATENATED MODULE: ./src/pages/pagebuild/ui-lib/policy/index.vue\nvar policy_normalizeComponent = __webpack_require__(\"VU/8\")\n/* script */\n\n/* template */\n\n/* template functional */\nvar policy___vue_template_functional__ = false\n/* styles */\nvar policy___vue_styles__ = null\n/* scopeId */\nvar policy___vue_scopeId__ = null\n/* moduleIdentifier (server only) */\nvar policy___vue_module_identifier__ = null\nvar policy_Component = policy_normalizeComponent(\n  ui_lib_policy,\n  pagebuild_ui_lib_policy,\n  policy___vue_template_functional__,\n  policy___vue_styles__,\n  policy___vue_scopeId__,\n  policy___vue_module_identifier__\n)\n\n/* harmony default export */ var pages_pagebuild_ui_lib_policy = (policy_Component.exports);\n\n// CONCATENATED MODULE: ./node_modules/babel-loader/lib!./node_modules/vue-loader/lib/selector.js?type=script&index=0!./src/pages/pagebuild/app.vue\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\n\n\n\n\n\n\n/* harmony default export */ var app = ({\n    data: function data() {\n        return {\n            shouldShowAuthDialog: true,\n            presentables: [],\n            tabs: [],\n            activeTabName: 'presentables'\n        };\n    },\n\n    components: {\n        ToolBar: toolbar[\"a\" /* default */],\n        ContractState: pages_pagebuild_ui_lib_contract_state,\n        Presentables: pages_pagebuild_ui_lib_presentables,\n        'contract-manager': pages_pagebuild_ui_lib_contract,\n        'policy-manager': pages_pagebuild_ui_lib_policy\n    },\n    mounted: function mounted() {\n        this.$emit('ready', this);\n    },\n\n    methods: {\n        _tabChange: function _tabChange(data) {\n            console.log(data);\n            var isExisted = this.tabs.some(function (tab) {\n                return tab.name === data.name;\n            });\n\n            if (!isExisted) {\n                this.tabs.push(data);\n            }\n            this.activeTabName = data.name;\n        },\n        _removeTab: function _removeTab(targetName) {\n            var _this = this;\n\n            var activeName = this.activeTabName;\n            if (activeName === targetName) {\n                this.tabs.forEach(function (tab, index) {\n                    if (tab.name === targetName) {\n                        var nextTab = _this.tabs[index + 1] || _this.tabs[index - 1];\n                        if (nextTab) {\n                            activeName = nextTab.name;\n                        } else {\n                            activeName = null;\n                        }\n                    }\n                });\n            }\n\n            this.activeTabName = activeName || 'presentables';\n            this.tabs = this.tabs.filter(function (t) {\n                return t.name !== targetName;\n            });\n        },\n        _closeDialogHandler: function _closeDialogHandler() {\n            //todo call callbacks\n            this.$emit('close');\n        },\n        showAuthDialog: function showAuthDialog() {\n            this.shouldShowAuthDialog = true;\n        },\n        appendData: function appendData(data) {\n            this.presentables.push(data);\n        }\n    }\n});\n// CONCATENATED MODULE: ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-c4bdffc0\",\"hasScoped\":true,\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/pages/pagebuild/app.vue\nvar app_render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{attrs:{\"id\":\"app\"}},[_c('tool-bar'),_vm._v(\" \"),_c('el-dialog',{attrs:{\"close-on-click-modal\":false,\"title\":\"合约管理列表\",\"visible\":_vm.shouldShowAuthDialog,\"fullscreen\":false,\"custom-class\":\"auth-dialog\",\"width\":\"50%\",\"center\":\"\"},on:{\"update:visible\":function($event){_vm.shouldShowAuthDialog=$event},\"close\":_vm._closeDialogHandler}},[_c('el-tabs',{attrs:{\"type\":\"border-card\"},on:{\"tab-remove\":_vm._removeTab},model:{value:(_vm.activeTabName),callback:function ($$v) {_vm.activeTabName=$$v},expression:\"activeTabName\"}},[_c('el-tab-pane',{attrs:{\"label\":\"presentable list\",\"name\":\"presentables\"}},[_c('presentables',{attrs:{\"data\":_vm.presentables},on:{\"tabChange\":_vm._tabChange}})],1),_vm._v(\" \"),_vm._l((_vm.tabs),function(item,index){return _c('el-tab-pane',{key:item.name,attrs:{\"closable\":\"\",\"label\":item.title,\"name\":item.name}},[_c(item.content,{tag:\"component\",attrs:{\"data\":item.data}})],1)})],2)],1)],1)}\nvar app_staticRenderFns = []\nvar app_esExports = { render: app_render, staticRenderFns: app_staticRenderFns }\n/* harmony default export */ var pagebuild_app = (app_esExports);\n// CONCATENATED MODULE: ./src/pages/pagebuild/app.vue\nfunction app_injectStyle (ssrContext) {\n  __webpack_require__(\"8Yzw\")\n}\nvar app_normalizeComponent = __webpack_require__(\"VU/8\")\n/* script */\n\n/* template */\n\n/* template functional */\nvar app___vue_template_functional__ = false\n/* styles */\nvar app___vue_styles__ = app_injectStyle\n/* scopeId */\nvar app___vue_scopeId__ = \"data-v-c4bdffc0\"\n/* moduleIdentifier (server only) */\nvar app___vue_module_identifier__ = null\nvar app_Component = app_normalizeComponent(\n  app,\n  pagebuild_app,\n  app___vue_template_functional__,\n  app___vue_styles__,\n  app___vue_scopeId__,\n  app___vue_module_identifier__\n)\n\n/* harmony default export */ var pages_pagebuild_app = __webpack_exports__[\"a\"] = (app_Component.exports);\n\n\n/***/ }),\n\n/***/ \"qsBO\":\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\nfunction importHtml(href) {\n    return new Promise(function (resolve, reject) {\n        var link = document.createElement('link');\n        link.onload = resolve;\n        link.onerror = reject;\n        link.rel = 'import';\n        link.href = href;\n        document.head.appendChild(link);\n    });\n}\n\n/* harmony default export */ __webpack_exports__[\"a\"] = ({\n    start: function start() {\n        var self = this;\n        var authInfo = window.__auth_info__;\n        var authErrorData = authInfo.__auth_error_info__;\n\n        if (!authErrorData) {\n            self.loadWidgets();\n        } else {\n            window.FreeLogApp.trigger(window.FreeLogApp.ExceptionCode.invalidResponse, authErrorData.data || {});\n        }\n    },\n    getWidgets: function getWidgets() {\n        var $page = document.querySelector('#js-page-container');\n        var $widgets = $page.querySelectorAll('.js-wc-widget');\n        return $widgets;\n    },\n    loadWidgets: function loadWidgets() {\n        var $widgets = this.getWidgets();\n        var url = '//api.freelog.com/v1/nodes/' + window.__auth_info__.__auth_node_id__ + '/presentables/';\n        Array.from($widgets).forEach(function (widget) {\n            var prensentableId = widget.getAttribute('data-widget-presentable-id');\n            if (prensentableId) {\n                window.QI.fetchPresentable(prensentableId + '.data').then(function (res) {\n                    return res.json();\n                }).then(function (data) {\n                    window.FreeLogApp.trigger(window.FreeLogApp.ExceptionCode.invalidResponse, data);\n                }).catch(function (err) {\n                    //json解析不成功默认是成功情况,待优化判断逻辑\n                    importHtml('' + url + prensentableId + '.data');\n                });\n            } else {\n                //还没授权\n            }\n        });\n    }\n});\n\n/***/ }),\n\n/***/ \"yfD/\":\n/***/ (function(module, exports, __webpack_require__) {\n\n// removed by extract-text-webpack-plugin\n    if(false) {\n      // 1513237844580\n      var cssReload = require(\"../../../../../node_modules/css-hot-loader/hotModuleReplacement.js\")(module.id, {\"fileMap\":\"{fileName}\"});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  \n\n/***/ })\n\n},[\"UHGq\"]);\n\n\n// WEBPACK FOOTER //\n// pages/pagebuild/demo.315234cd3c51880a20e2.js","//异常对应的handler函数名\r\nconst EventCode = {\r\n    invalidResponse: 'errorResponseHandler'\r\n}\r\n\r\n\r\nexport default EventCode\n\n\n// WEBPACK FOOTER //\n// ./src/pages/pagebuild/exception_code.js","var dataloaderHelpers = {\r\n    loadResourceDetail(resourceId) {\r\n        return window.QI.fetch(`//api.freelog.com/v1/resources/${resourceId}`).then((res) => {\r\n            if (res.status === 200) {\r\n                return res.json()\r\n            } else {\r\n                return Promise.reject(res)\r\n            }\r\n        }).then((res) => {\r\n            if (res.ret === 0 && res.errcode === 0) {\r\n                return res.data\r\n            } else {\r\n                return Promise.reject(res)\r\n            }\r\n        })\r\n    },\r\n    loadPresentableDetail(presentableId) {\r\n        return window.QI.fetch(`//api.freelog.com/v1/presentables/${presentableId}`).then((res) => {\r\n            if (res.status === 200) {\r\n                return res.json()\r\n            } else {\r\n                return Promise.reject(res)\r\n            }\r\n        }).then((res) => {\r\n            if (res.ret === 0 && res.errcode === 0) {\r\n                return res.data\r\n            } else {\r\n                return Promise.reject(res)\r\n            }\r\n        })\r\n    },\r\n\r\n    loadContractDetail(data) {\r\n        var contractData = data.contract\r\n        return this.loadPresentableDetail(contractData.targetId)\r\n            .then((data) => {\r\n                contractData.resourceDetail = data.tagInfo.resourceInfo\r\n                data.contractDetail = contractData\r\n                data.resourceDetail = data.tagInfo.resourceInfo\r\n                return data\r\n            })\r\n    },\r\n    loadPolicyDetail(authData) {\r\n        var presentableId = authData.presentableId;\r\n        return this.loadPresentableDetail(presentableId)\r\n            .then((data) => {\r\n                data.resourceDetail = data.tagInfo.resourceInfo\r\n                return data\r\n            })\r\n    }\r\n}\r\n\r\nexport default {\r\n    name: 'errorResponseHandler',\r\n    handle(data, appUI, callback) {\r\n        this.appUI = appUI\r\n\r\n        if (typeof callback === 'function') {\r\n            appUI.$on('close', function () {\r\n                //todo\r\n                console.log('error response close')\r\n            })\r\n        }\r\n\r\n        if (data && data.errcode) {\r\n            var errorMsg = data.msg;\r\n            var resData = data.data && data.data.data\r\n            switch (data.errcode) {\r\n                //未激活状态\r\n                case 70080104:\r\n                    dataloaderHelpers.loadContractDetail(resData)\r\n                        .then(this.appendDataToUI.bind(this));\r\n                    break;\r\n                //未签约状态\r\n                case 70080101:\r\n                    dataloaderHelpers.loadPolicyDetail(resData)\r\n                        .then(this.appendDataToUI.bind(this));\r\n                    break;\r\n                //节点与资源之间的合约授权失败\r\n                case 70080202:\r\n                    console.log(errorMsg, resData)\r\n                    break;\r\n                default:\r\n                    break;\r\n            }\r\n        }\r\n    },\r\n    appendDataToUI(data) {\r\n        this.appUI.appendData(data)\r\n        this.appUI.showAuthDialog()\r\n    }\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/pages/pagebuild/service/errorResponseHandler.js","import errorResponseHandler from './errorResponseHandler'\r\n\r\nexport default {\r\n    errorResponseHandler\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/pages/pagebuild/service/index.js","import Vue from 'vue'\r\nimport Service from './service'\r\n\r\nconst DEFAULT_EVENT_NAME = 'freelogSystemService';\r\n\r\nexport default {\r\n    init(appUI) {\r\n        this.appUI = appUI\r\n        this.bus = new Vue()\r\n        //统一监听服务，根据action进行分发执行器\r\n        this.bus.$on(DEFAULT_EVENT_NAME, this.dispatchHandler.bind(this))\r\n    },\r\n    dispatchHandler(event) {\r\n        var detail = event.detail\r\n        var handlerName = detail.eventName\r\n        var opts = detail.opts\r\n        var Handler\r\n        if ((Handler = Service[handlerName])) {\r\n            Handler.handle(opts.data, this.appUI, opts.callback)\r\n        } else {\r\n            console.warn('不存在对应的异常处理函数')\r\n        }\r\n    },\r\n    trigger(eventName, opts) {\r\n        this.bus.$emit(DEFAULT_EVENT_NAME, {\r\n            detail: {\r\n                eventName: eventName,\r\n                opts: opts\r\n            }\r\n        })\r\n    }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/pagebuild/event-dispatcher.js","import Vue from '@/layout'\r\n\r\nimport AppView from '../app.vue'\r\n\r\nimport PageBuildeParser from '../parser'\r\nimport EventCode from '../exception_code'\r\nimport EventDispatcher from '../event-dispatcher'\r\n\r\n//对外接口服务\r\nvar App = {\r\n    isValidResponse(res) {\r\n        return (res && (res.ret === 0 && res.errcode === 0))\r\n    },\r\n    trigger() {\r\n        EventDispatcher.trigger.apply(EventDispatcher, arguments)\r\n    },\r\n    EventCode\r\n}\r\n\r\nfunction main() {\r\n    window.QI = document.querySelector('.js-lib-qi');\r\n\r\n    //render app view\r\n    new Vue({\r\n        el: '#app',\r\n        template: '<app-view @ready=\"onReady\"/>',\r\n        components: {'app-view': AppView},\r\n        methods: {\r\n            onReady(appUI) {\r\n                //挂载UI\r\n                this.appUI = appUI\r\n                window.FreeLogApp = App;\r\n                EventDispatcher.init(appUI)\r\n                PageBuildeParser.start()\r\n                appUI.$on('close', function () {\r\n                    console.log('close app ui dialog')\r\n                })\r\n            }\r\n        }\r\n    });\r\n}\r\n\r\nmain()\r\n\r\nexport default App\n\n\n// WEBPACK FOOTER //\n// ./src/pages/pagebuild/demo/app.js","function injectStyle (ssrContext) {\n  require(\"!!css-hot-loader!../../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!style-loader!css-loader!../../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-562dac57\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!postcss-loader!less-loader!../../../node_modules/vue-loader/lib/selector?type=styles&index=0!./index.vue\")\n}\nvar normalizeComponent = require(\"!../../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nimport __vue_script__ from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./index.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-562dac57\\\",\\\"hasScoped\\\":true,\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../node_modules/vue-loader/lib/selector?type=template&index=0!./index.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-562dac57\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/components/toolbar/index.vue\n// module id = null\n// module chunks = ","export default {\r\n    name: 'tool-bar',\r\n    data() {\r\n        return {}\r\n    },\r\n    mounted() {\r\n\r\n    },\r\n    methods: {\r\n        showAuthDialog() {\r\n            var event = new CustomEvent('freelogService', {\r\n                detail: {\r\n                    action: 'showAuthDialog'\r\n                }\r\n            });\r\n            window.dispatchEvent(event)\r\n        }\r\n    }\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/components/toolbar/index.js","<template>\r\n    <ul class=\"tool-bar-wrap\">\r\n        <li class=\"user-tab\" title=\"个人中心\"><a href=\"/pages/user/index.html\" target=\"_blank\"><i class=\"el-icon-fa-user\" aria-hidden=\"true\"></i></a></li>\r\n        <li class=\"contract-tab\" @click=\"showAuthDialog\" title=\"合同管理\"><i class=\"el-icon-document\"></i></li>\r\n    </ul>\r\n</template>\r\n\r\n<script>\r\n    import ToolBar from './index'\r\n    export default ToolBar\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n@import \"index.less\";\r\n\r\n</style>\n\n\n// WEBPACK FOOTER //\n// src/components/toolbar/index.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('ul',{staticClass:\"tool-bar-wrap\"},[_vm._m(0,false,false),_vm._v(\" \"),_c('li',{staticClass:\"contract-tab\",attrs:{\"title\":\"合同管理\"},on:{\"click\":_vm.showAuthDialog}},[_c('i',{staticClass:\"el-icon-document\"})])])}\nvar staticRenderFns = [function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('li',{staticClass:\"user-tab\",attrs:{\"title\":\"个人中心\"}},[_c('a',{attrs:{\"href\":\"/pages/user/index.html\",\"target\":\"_blank\"}},[_c('i',{staticClass:\"el-icon-fa-user\",attrs:{\"aria-hidden\":\"true\"}})])])}]\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-562dac57\",\"hasScoped\":true,\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/components/toolbar/index.vue\n// module id = null\n// module chunks = ","//https://stackoverflow.com/questions/16058073/how-do-i-draw-a-graph-or-tree-structure-in-javascript\r\n//http://bl.ocks.org/rkirsling/5001347\r\n// https://bl.ocks.org/cjrd/6863459\r\n//https://bl.ocks.org/curran/5905182da50a4667dc00\r\n// https://bl.ocks.org/mbostock/1138500\r\nfunction DirectGraph(opts) {\r\n    opts = opts || {}\r\n    var width = opts.width || 960,\r\n        height = opts.height || 500,\r\n        colors = d3.scale.category10();\r\n    var Radius = opts.radius || 20;\r\n\r\n    var self = this;\r\n    var $svg;\r\n    var $container = (typeof opts.container === 'string') ? document.querySelector(opts.container) : opts.container;\r\n    this._opts = opts\r\n\r\n    if (opts.container) {\r\n        $svg = d3.select(opts.container)\r\n    } else {\r\n        $svg = d3.select(\"body\").append(\"svg\")\r\n    }\r\n    $svg.attr('width', width)\r\n        .attr('height', height);\r\n\r\n    var $tip = $container.parentNode.querySelector('.js-svg-tip')\r\n    if (!$tip) {\r\n        $tip = document.createElement('div')\r\n        $tip.classList.add('tip')\r\n        $container.parentNode.appendChild($tip)\r\n    }\r\n    var nodes = [];\r\n    var links = [];\r\n\r\n// init D3 force layout\r\n    var force = d3.layout.force()\r\n        .size([width, height])\r\n        .linkDistance(150)\r\n        .charge(-500)\r\n        .on('tick', tick)\r\n\r\n// define arrow markers for graph links\r\n    $svg.append('svg:defs').append('svg:marker')\r\n        .attr('id', 'end-arrow')\r\n        .attr('viewBox', '0 -5 10 10')\r\n        .attr('refX', 6)\r\n        .attr('markerWidth', 3)\r\n        .attr('markerHeight', 3)\r\n        .attr('orient', 'auto')\r\n        .append('svg:path')\r\n        .attr('d', 'M0,-5L10,0L0,5')\r\n        .attr('fill', '#000');\r\n\r\n    $svg.append('svg:defs').append('svg:marker')\r\n        .attr('id', 'start-arrow')\r\n        .attr('viewBox', '0 -5 10 10')\r\n        .attr('refX', 4)\r\n        .attr('markerWidth', 3)\r\n        .attr('markerHeight', 3)\r\n        .attr('orient', 'auto')\r\n        .append('svg:path')\r\n        .attr('d', 'M10,-5L0,0L10,5')\r\n        .attr('fill', '#000');\r\n\r\n    // handles to link and node element groups\r\n    var path = $svg.append('svg:g').selectAll('path'),\r\n        circle = $svg.append('svg:g').selectAll('g');\r\n\r\n// update force layout (called automatically each iteration)\r\n    function tick() {\r\n        // draw directed edges with proper padding from node centers\r\n        path.attr('d', function (d) {\r\n            var deltaX = d.target.x - d.source.x,\r\n                deltaY = d.target.y - d.source.y,\r\n                dist = Math.sqrt(deltaX * deltaX + deltaY * deltaY),\r\n                normX = deltaX / dist,\r\n                normY = deltaY / dist,\r\n                sourcePadding = d.left ? 17 : 12,\r\n                targetPadding = d.right ? 17 : 12,\r\n                sourceX = d.source.x + (sourcePadding * normX),\r\n                sourceY = d.source.y + (sourcePadding * normY),\r\n                targetX = d.target.x - (targetPadding * normX),\r\n                targetY = d.target.y - (targetPadding * normY);\r\n            return 'M' + sourceX + ',' + sourceY + 'L' + targetX + ',' + targetY;\r\n        });\r\n\r\n        circle.attr('transform', function (d) {\r\n            return 'translate(' + d.x + ',' + d.y + ')';\r\n        });\r\n    }\r\n\r\n    //selected变虚线\r\n    function restart() {\r\n        // path (link) group\r\n        path = path.data(links);\r\n\r\n        // update existing links\r\n        path.style('marker-start', function (d) {\r\n            return d.left ? 'url(#start-arrow)' : '';\r\n        }).style('marker-end', function (d) {\r\n            return d.right ? 'url(#end-arrow)' : '';\r\n        });\r\n\r\n\r\n        // add new links\r\n        path.enter().append('svg:path')\r\n            .attr('class', function (d) {\r\n                return d.target.data.stateClass + ' link'\r\n            })\r\n            .style('marker-start', function (d) {\r\n                return d.left ? 'url(#start-arrow)' : '';\r\n            })\r\n            .style('marker-end', function (d) {\r\n                return d.right ? 'url(#end-arrow)' : '';\r\n            })\r\n            .on('mouseenter', function (p) {\r\n                var src = p.source;\r\n                var target = p.target\r\n                var pos = d3.mouse(this)\r\n\r\n                $tip.style.opacity = 1\r\n                $tip.style.top = pos[1] + 'px'\r\n                $tip.style.left = pos[0] + 'px'\r\n                if (self._opts.overlayHandler) {\r\n                    self._opts.overlayHandler(p, $tip)\r\n                } else {\r\n                    $tip.innerHTML = JSON.stringify({\r\n                        source: src.data.state,\r\n                        target: target.data.state\r\n                    })\r\n                }\r\n            })\r\n\r\n        // remove old links\r\n        path.exit().remove();\r\n\r\n        // circle (node) group\r\n        // NB: the function arg is crucial here! nodes are known by id, not by index!\r\n        circle = circle.data(nodes, function (d) {\r\n            return d.id;\r\n        });\r\n\r\n        // update existing nodes (reflexive & selected visual states)\r\n        circle.selectAll('circle')\r\n            .classed('reflexive', function (d) {\r\n                return d.reflexive;\r\n            });\r\n\r\n        // add new nodes\r\n        var g = circle.enter().append('svg:g');\r\n        g.append('svg:circle')\r\n            .attr('class', function (d) {\r\n                return 'node ' + (d.data.stateClass || '')\r\n            })\r\n            .attr('r', Radius)\r\n            .on('mouseenter', function (d) {\r\n                $tip.style.opacity = 1\r\n                $tip.style.top = (d.y - Radius) + 'px'\r\n                $tip.style.left = (d.x + Radius * 1.5) + 'px'\r\n                if (self._opts.overlayHandler) {\r\n                    self._opts.overlayHandler(d.data, $tip)\r\n                } else {\r\n                    $tip.innerHTML = JSON.stringify(d.data)\r\n                }\r\n            })\r\n\r\n        // show node IDs\r\n        g.append('svg:text')\r\n            .attr('x', 0)\r\n            .attr('y', 4)\r\n            .attr('class', 'id')\r\n            .text(function (d) {\r\n                // return d.data.state\r\n                return d.id;\r\n            });\r\n\r\n        // remove old nodes\r\n        circle.exit().remove();\r\n\r\n        // set the graph in motion\r\n        force.start();\r\n    }\r\n\r\n    opts.nodes.forEach(function (node) {\r\n        nodes.push(node);\r\n        restart();\r\n    })\r\n\r\n    opts.links.forEach(function (link) {\r\n        links.push(link);\r\n        restart();\r\n    })\r\n    return this\r\n}\r\n\r\n\r\nexport default DirectGraph\r\n\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/pagebuild/ui-lib/contract-state/direct-graph.js","import DirectGraph from './direct-graph'\r\n\r\nvar lastNodeId = -1;\r\n\r\nfunction createNode(props, data) {\r\n    var node = {id: ++lastNodeId, reflexive: false, data: data};\r\n    Object.assign(node, props)\r\n    return node\r\n}\r\n\r\n//创建渲染需要的数据结构\r\nfunction formatNodes(nodeList) {\r\n    var nodes = [];\r\n    var links = []\r\n    var nodeMap = {}\r\n\r\n    nodeList.forEach(function (nodeArr, index) {\r\n        nodeArr.forEach(function (node) {\r\n            node.stateClass = resolveStateClass(node)\r\n            var tmp = createNode(node.pos, node)\r\n\r\n            nodeMap[node.state] = tmp\r\n            nodes.push(tmp)\r\n        })\r\n    })\r\n\r\n    nodes.forEach(function (node) {\r\n        node.data.nextStates.forEach(function (next) {\r\n            links.push({\r\n                source: node,\r\n                target: nodeMap[next.state],\r\n                left: false,\r\n                right: true\r\n            })\r\n        })\r\n    })\r\n    return {nodes, links}\r\n}\r\n\r\n\r\n//生成d3 tree结构\r\nfunction generateRoot(stateTreeRoot) {\r\n    var node = {\r\n        name: stateTreeRoot.state,\r\n        children: []\r\n    }\r\n\r\n    stateTreeRoot.nextStates.forEach(function (next) {\r\n        node.children.push(generateRoot(next))\r\n    })\r\n\r\n    return node\r\n}\r\n\r\nfunction resolveStateClass(state) {\r\n    var stateCls = 'is-disabled'\r\n    if (state.isProcess) {\r\n        stateCls = 'is-process'\r\n    } else if (state.isFinish) {\r\n        stateCls = 'is-finish'\r\n    } else if (state.isWaiting) {\r\n        stateCls = 'is-wait'\r\n    }\r\n\r\n    if (state.isActive) {\r\n        stateCls += ' is-active'\r\n    }\r\n    return stateCls\r\n}\r\n\r\n//根据d3 tree生成的节点坐标设置force 节点的坐标\r\nfunction setTreeNodePosition(result, opts) {\r\n    var root = generateRoot(result.stateTreeRoot)\r\n    var height = opts.height;\r\n    var width = opts.width;\r\n    var tree = d3.layout.tree().size([height, width])\r\n    var nodes = tree.nodes(root)\r\n    nodes.forEach(function (node) {\r\n        var keys = ['depth', 'x', 'y']\r\n        var stateNode = result.stateMap[node.name]\r\n        if (stateNode) {\r\n            stateNode.pos = {}\r\n            keys.forEach(function (key) {\r\n                stateNode.pos[key] = node[key]\r\n            })\r\n            //将纵向变成横向\r\n            var x = stateNode.pos.x\r\n            stateNode.pos.x = stateNode.pos.y\r\n            stateNode.pos.y = x\r\n        }\r\n    })\r\n}\r\n\r\nfunction parseContract(contractData) {\r\n    var curState = contractData.fsmState\r\n    var policySegment = contractData.policySegment\r\n    var descs = policySegment.fsmDescription\r\n    var activatedStates = policySegment.activatedStates\r\n    var initialState = policySegment.initialState\r\n    var stateMap = {}\r\n    var stateTreeRoot;\r\n\r\n    function initStateNode(stateName) {\r\n        return {\r\n            nextStates: [],\r\n            targetEvents: [], //到下一状态可能的路径(事件)\r\n            state: stateName,\r\n            isActive: activatedStates.includes(stateName),\r\n            isProcess: stateName === curState,\r\n            deep: 0\r\n        };\r\n    }\r\n\r\n    var nodeList = [] //每层的节点列表\r\n\r\n    function walkTree(node) {\r\n        if (!nodeList[node.deep]) {\r\n            nodeList[node.deep] = []\r\n        }\r\n        nodeList[node.deep].push(node)\r\n\r\n        if (!node.nextStates.length) {\r\n            return\r\n        }\r\n\r\n        node.nextStates.forEach(function (nextNode) {\r\n            var nextStateNode = stateMap[nextNode.state]\r\n            nextStateNode.deep = node.deep + 1\r\n\r\n            if (node.isProcess || node.isWaiting) {\r\n                nextStateNode.isWaiting = true\r\n            }\r\n\r\n            if (nextStateNode.isProcess) {\r\n                node.isFinish = true\r\n            }\r\n\r\n            if (nextStateNode.targetEvents.length) {\r\n                nextStateNode.targetEvents.forEach(function (event) {\r\n                    if (stateMap[event.nextState] && event.nextState !== node.state) {\r\n                        nextStateNode.nextStates.push(stateMap[event.nextState])\r\n                    }\r\n                })\r\n            }\r\n            walkTree(nextStateNode)\r\n\r\n            if (nextStateNode.isFinish) {\r\n                node.isFinish = true\r\n            }\r\n        })\r\n    }\r\n\r\n    descs.forEach((desc) => {\r\n        var curStateNode = stateMap[desc.currentState] || initStateNode(desc.currentState)\r\n        var nextStateNode = stateMap[desc.nextState]\r\n\r\n        curStateNode.targetEvents.push(desc)\r\n\r\n        if (!nextStateNode) {\r\n            nextStateNode = initStateNode(desc.nextState);\r\n            stateMap[desc.nextState] = nextStateNode\r\n        }\r\n\r\n        //标记根节点的next，便于初始化遍历\r\n        if (desc.currentState === initialState) {\r\n            curStateNode.nextStates.push(nextStateNode)\r\n        }\r\n        stateMap[desc.currentState] = curStateNode\r\n    })\r\n\r\n    stateTreeRoot = stateMap[initialState]\r\n    walkTree(stateTreeRoot)\r\n\r\n    return {stateTreeRoot, stateMap, nodeList}\r\n}\r\n\r\nexport default {\r\n    name: 'contract-state',\r\n    props: {\r\n        data: {\r\n            type: Object,\r\n            default() {\r\n                return null\r\n            }\r\n        }\r\n    },\r\n    data() {\r\n        var self = this;\r\n        return {\r\n            popData: {},\r\n            opts: {\r\n                radius: 12,\r\n                width: 400,\r\n                height: 200,\r\n                container: null,\r\n                overlayHandler: function (data) {\r\n                    var popData = Object.assign({}, data)\r\n                    if (data.source) {\r\n                        popData.type = 'path'\r\n                        popData.disabled = data.target.data.stateClass.indexOf('is-disabled') > -1;\r\n                        var triggerEvents = data.source.data.targetEvents.filter((event) => {\r\n                            return event.nextState === data.target.data.state\r\n                        });\r\n                        popData.event = (triggerEvents[0] && triggerEvents[0].event) || {}\r\n                    } else { //node\r\n                        popData.type = 'node'\r\n                    }\r\n\r\n                    if (!popData.disabled) {\r\n                        self.popData = popData\r\n                        self.$refs.popover.showPopper = true\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    },\r\n    mounted() {\r\n        var style = getComputedStyle(this.$refs.wrapper)\r\n\r\n        this.opts.container = this.$refs.stateTree;\r\n        this.opts.width = parseInt(parseInt(style.width) * .8)\r\n        this.draw()\r\n    },\r\n    methods: {\r\n        updateContractState(state) {\r\n            state.isProcess = true\r\n            state.isActivated = true;\r\n        },\r\n        triggerLicense(data) {\r\n            return window.QI.fetch('//api.freelog.com/v1/contracts/signingLicenses', {\r\n                method: 'POST',\r\n                data: data\r\n            }).then((res) => {\r\n                return res.json()\r\n            })\r\n        },\r\n        triggerContractState(data) {\r\n            return window.QI.fetch('//api.freelog.com/v1/contracts/test', {\r\n                method: 'POST',\r\n                data: data\r\n            }).then((res) => {\r\n                return res.json()\r\n            })\r\n        },\r\n        activateContractHandler(data) {\r\n            var self = this;\r\n            var contract = self.data;\r\n            var contractId = contract.contractId\r\n            var source = data.source.data\r\n            var target = data.target.data\r\n            var nextState = target.state;\r\n\r\n            var triggerEvents = source.targetEvents.filter((event) => {\r\n                return event.nextState === nextState\r\n            })\r\n\r\n            if (triggerEvents.length === 0) {\r\n                return self.$message.error('没有可触发的事件')\r\n            } else {\r\n                triggerEvents.forEach((trigger) => {\r\n                    if (trigger.event.type === 'compoundEvents') {\r\n                        trigger.event.params.forEach((event) => {\r\n                            triggerHandler(event)\r\n                        })\r\n                    } else {\r\n                        triggerHandler(trigger.event)\r\n                    }\r\n                })\r\n            }\r\n\r\n            function triggerHandler(event) {\r\n                var promise;\r\n                if (event.type === 'signing') {\r\n                    promise = self.triggerLicense({\r\n                        contractId: contractId,\r\n                        eventId: event.eventId,\r\n                        licenseIds: event.params\r\n                    })\r\n                } else {\r\n                    promise = self.triggerContractState({\r\n                        contractId: contractId,\r\n                        eventId: event.eventId\r\n                    })\r\n                }\r\n\r\n                Promise.resolve(promise).then((data) => {\r\n                    if (data.ret === 0 && data.errcode === 0) {\r\n                        self.$message.success('操作成功');\r\n                        self.updateContractState(contract, nextState)\r\n                    } else {\r\n                        self.$message.error(data.msg)\r\n                    }\r\n                })\r\n            }\r\n        },\r\n        hidePopover(event) {\r\n            if (['circle', 'path'].includes(event.target.nodeName) || this.$refs.popover.$el.contains(event.target)) {\r\n                event.stopPropagation()\r\n            } else {\r\n                this.$refs.popover.showPopper = false\r\n            }\r\n        },\r\n        draw() {\r\n            if (!this.data.contractId) {\r\n                return\r\n            }\r\n            var result = parseContract(this.data)\r\n            setTreeNodePosition(result, this.opts)\r\n            var resolveData = formatNodes(result.nodeList)\r\n            Object.assign(this.opts, resolveData)\r\n            new DirectGraph(this.opts)\r\n        },\r\n        update(data) {\r\n            this.data = data;\r\n            this.draw()\r\n        }\r\n    }\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/pages/pagebuild/ui-lib/contract-state/index.js","function injectStyle (ssrContext) {\n  require(\"!!css-hot-loader!../../../../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!style-loader!css-loader!../../../../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-0b962c39\\\",\\\"scoped\\\":false,\\\"hasInlineConfig\\\":false}!postcss-loader!less-loader!../../../../../node_modules/vue-loader/lib/selector?type=styles&index=0!./index.vue\")\n}\nvar normalizeComponent = require(\"!../../../../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nimport __vue_script__ from \"!!babel-loader!../../../../../node_modules/vue-loader/lib/selector?type=script&index=0!./index.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-0b962c39\\\",\\\"hasScoped\\\":false,\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../../../node_modules/vue-loader/lib/selector?type=template&index=0!./index.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = null\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/pages/pagebuild/ui-lib/contract-state/index.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!css-hot-loader!../../../../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!style-loader!css-loader!../../../../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-bdfded6c\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!postcss-loader!less-loader!../../../../../node_modules/vue-loader/lib/selector?type=styles&index=0!./index.vue\")\n}\nvar normalizeComponent = require(\"!../../../../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nimport __vue_script__ from \"!!babel-loader!../../../../../node_modules/vue-loader/lib/selector?type=script&index=0!./index.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-bdfded6c\\\",\\\"hasScoped\\\":true,\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../../../node_modules/vue-loader/lib/selector?type=template&index=0!./index.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-bdfded6c\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/pages/pagebuild/ui-lib/contract/index.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!css-hot-loader!../../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!style-loader!css-loader!../../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-c4bdffc0\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!postcss-loader!less-loader!../../../node_modules/vue-loader/lib/selector?type=styles&index=0!./app.vue\")\n}\nvar normalizeComponent = require(\"!../../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nimport __vue_script__ from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./app.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-c4bdffc0\\\",\\\"hasScoped\\\":true,\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../node_modules/vue-loader/lib/selector?type=template&index=0!./app.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-c4bdffc0\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/pages/pagebuild/app.vue\n// module id = null\n// module chunks = ","<template>\r\n    <div class=\"contract-state-wrap\" ref=\"wrapper\" @click=\"hidePopover\">\r\n        <el-popover\r\n                ref=\"popover\"\r\n                popper-class=\"tip js-svg-tip\"\r\n                placement=\"top\"\r\n                trigger=\"click\"\r\n                width=\"250\">\r\n            <div>\r\n                <div v-show=\"popData.type == 'node'\">\r\n                    <h3>state:{{popData.state}}</h3>\r\n                    <ul>\r\n                        <li>isActiveState: {{popData.isActive}}</li>\r\n                        <li>isProcess: {{popData.isProcess}}</li>\r\n                        <li>isFinish: {{(popData.isFinish === undefined)? 'false': popData.isFinish}}</li>\r\n                    </ul>\r\n                </div>\r\n                <div v-if=\"popData.type == 'path'&& popData.source\">\r\n                    <p>event name: {{popData.event.eventName}}</p>\r\n                    <p>from {{popData.source.data.state}} to {{popData.target.data.state}}</p>\r\n                    <el-button size=\"mini\" @click=\"activateContractHandler(popData)\">trigger</el-button>\r\n                </div>\r\n            </div>\r\n        </el-popover>\r\n\r\n        <svg ref=\"stateTree\"></svg>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\n    import ContractState from './index'\r\n\r\n    export default ContractState\r\n</script>\r\n\r\n<style lang=\"less\">\r\n    @import \"index.less\";\r\n</style>\n\n\n// WEBPACK FOOTER //\n// src/pages/pagebuild/ui-lib/contract-state/index.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{ref:\"wrapper\",staticClass:\"contract-state-wrap\",on:{\"click\":_vm.hidePopover}},[_c('el-popover',{ref:\"popover\",attrs:{\"popper-class\":\"tip js-svg-tip\",\"placement\":\"top\",\"trigger\":\"click\",\"width\":\"250\"}},[_c('div',[_c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.popData.type == 'node'),expression:\"popData.type == 'node'\"}]},[_c('h3',[_vm._v(\"state:\"+_vm._s(_vm.popData.state))]),_vm._v(\" \"),_c('ul',[_c('li',[_vm._v(\"isActiveState: \"+_vm._s(_vm.popData.isActive))]),_vm._v(\" \"),_c('li',[_vm._v(\"isProcess: \"+_vm._s(_vm.popData.isProcess))]),_vm._v(\" \"),_c('li',[_vm._v(\"isFinish: \"+_vm._s((_vm.popData.isFinish === undefined)? 'false': _vm.popData.isFinish))])])]),_vm._v(\" \"),(_vm.popData.type == 'path'&& _vm.popData.source)?_c('div',[_c('p',[_vm._v(\"event name: \"+_vm._s(_vm.popData.event.eventName))]),_vm._v(\" \"),_c('p',[_vm._v(\"from \"+_vm._s(_vm.popData.source.data.state)+\" to \"+_vm._s(_vm.popData.target.data.state))]),_vm._v(\" \"),_c('el-button',{attrs:{\"size\":\"mini\"},on:{\"click\":function($event){_vm.activateContractHandler(_vm.popData)}}},[_vm._v(\"trigger\")])],1):_vm._e()])]),_vm._v(\" \"),_c('svg',{ref:\"stateTree\"})],1)}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-0b962c39\",\"hasScoped\":false,\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/pages/pagebuild/ui-lib/contract-state/index.vue\n// module id = null\n// module chunks = ","export const CONTRACT_STATUS = {\r\n    uncreated: -1,\r\n    initial: 1,\r\n    running: 2,\r\n    activated: 3,\r\n    userTerminated: 4,\r\n    sysTerminated: 5,\r\n    terminated: 6\r\n};\r\n\r\n\r\nexport const CONTRACT_STATUS_TIPS = {\r\n    '-1': '未创建合同',\r\n    1: '未开始执行',\r\n    2: '执行中',\r\n    3: '生效中',\r\n    4: '用户终止',\r\n    5: '系统终止',\r\n    6: '合同已终止'\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/pages/pagebuild/ui-lib/config.js","import {CONTRACT_STATUS, CONTRACT_STATUS_TIPS} from '../config'\r\n\r\n\r\nexport default {\r\n    name: 'presentables',\r\n\r\n    data() {\r\n        return {\r\n            CONTRACT_STATUS: CONTRACT_STATUS,\r\n            CONTRACT_STATUS_ACTION_TIPS: {\r\n                '-1': '去创建合同',\r\n                1: '去执行', //未开始执行\r\n                2: '去执行', //执行中\r\n                3: '生效中',\r\n                4: '用户终止',\r\n                5: '系统终止',\r\n                6: '合同已终止'\r\n            }\r\n        }\r\n    },\r\n    props: {\r\n        data: {\r\n            type: Array,\r\n            default() {\r\n                return null\r\n            }\r\n        }\r\n    },\r\n    mounted() {\r\n        this.formatPresentableList()\r\n        console.log(this.data)\r\n    },\r\n    watch: {\r\n        data: 'formatPresentableList'\r\n    },\r\n    methods: {\r\n        formatPresentableList() {\r\n            var self = this;\r\n            var presentables = self.data\r\n            presentables.forEach((presentable) => {\r\n                self.resovlePresentableStatus(presentable)\r\n            })\r\n        },\r\n        resovlePresentableStatus(presentable) {\r\n            if (presentable.contractDetail) {\r\n                presentable.contractStatus = presentable.contractDetail.status\r\n            } else {\r\n                presentable.contractStatus = CONTRACT_STATUS.uncreated\r\n            }\r\n\r\n            presentable.statusTip = CONTRACT_STATUS_TIPS[presentable.contractStatus] || 'n/a'\r\n        },\r\n        tabActionHandler(presentable) {\r\n            var tabConfig = {\r\n                content: 'contract-manager',\r\n                data: presentable,\r\n                title: '合同管理',\r\n                name: 'tab' + presentable.presentableId\r\n            }\r\n\r\n            switch (presentable.contractStatus) {\r\n                case CONTRACT_STATUS.uncreated:\r\n                    Object.assign(tabConfig, {\r\n                        title: '创建合同',\r\n                        content: 'policy-manager'\r\n                    })\r\n                    break;\r\n                case CONTRACT_STATUS.initial:\r\n                    break;\r\n                case CONTRACT_STATUS.running:\r\n                    break;\r\n                case CONTRACT_STATUS.activated:\r\n                    break;\r\n                case CONTRACT_STATUS.userTerminated:\r\n                    break;\r\n                case CONTRACT_STATUS.sysTerminated:\r\n                    break;\r\n                case CONTRACT_STATUS.terminated:\r\n                    break;\r\n            }\r\n\r\n            this.$emit('tabChange', tabConfig) //自己监听自己，但是处理函数定义在父级元素\r\n            // this.$message.warning('todo')\r\n        },\r\n        showPolicyDetailHandler() {\r\n\r\n        }\r\n    }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/pagebuild/ui-lib/presentables/index.js","<template>\r\n    <div>\r\n        <el-table\r\n                :data=\"data\"\r\n                ref=\"tableRef\"\r\n                stripe\r\n                style=\"width: 100%\">\r\n            <el-table-column\r\n                    label=\"资源名称\"\r\n                    prop=\"tagInfo.resourceInfo.resourceName\">\r\n            </el-table-column>\r\n            <el-table-column\r\n                    label=\"合同名称\"\r\n                    prop=\"name\">\r\n            </el-table-column>\r\n            <el-table-column\r\n                    label=\"资源类型\"\r\n                    prop=\"tagInfo.resourceInfo.resourceType\"\r\n                    width=\"120px\">\r\n            </el-table-column>\r\n            <el-table-column\r\n                    label=\"状态\"\r\n                    prop=\"statusTip\">\r\n            </el-table-column>\r\n            <el-table-column label=\"操作\" align=\"center\" width=\"120px\">\r\n                <template slot-scope=\"scope\">\r\n                    <el-button\r\n                            size=\"mini\"\r\n                            @click=\"tabActionHandler(scope.row, scope.$index)\">\r\n                        {{CONTRACT_STATUS_ACTION_TIPS[scope.row.contractStatus]}}\r\n                    </el-button>\r\n                </template>\r\n            </el-table-column>\r\n        </el-table>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\n    import Presentables from './index.js'\r\n    export default Presentables\r\n</script>\n\n\n// WEBPACK FOOTER //\n// src/pages/pagebuild/ui-lib/presentables/index.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('el-table',{ref:\"tableRef\",staticStyle:{\"width\":\"100%\"},attrs:{\"data\":_vm.data,\"stripe\":\"\"}},[_c('el-table-column',{attrs:{\"label\":\"资源名称\",\"prop\":\"tagInfo.resourceInfo.resourceName\"}}),_vm._v(\" \"),_c('el-table-column',{attrs:{\"label\":\"合同名称\",\"prop\":\"name\"}}),_vm._v(\" \"),_c('el-table-column',{attrs:{\"label\":\"资源类型\",\"prop\":\"tagInfo.resourceInfo.resourceType\",\"width\":\"120px\"}}),_vm._v(\" \"),_c('el-table-column',{attrs:{\"label\":\"状态\",\"prop\":\"statusTip\"}}),_vm._v(\" \"),_c('el-table-column',{attrs:{\"label\":\"操作\",\"align\":\"center\",\"width\":\"120px\"},scopedSlots:_vm._u([{key:\"default\",fn:function(scope){return [_c('el-button',{attrs:{\"size\":\"mini\"},on:{\"click\":function($event){_vm.tabActionHandler(scope.row, scope.$index)}}},[_vm._v(\"\\n                    \"+_vm._s(_vm.CONTRACT_STATUS_ACTION_TIPS[scope.row.contractStatus])+\"\\n                \")])]}}])})],1)],1)}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-7052f966\",\"hasScoped\":false,\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/pages/pagebuild/ui-lib/presentables/index.vue\n// module id = null\n// module chunks = ","var normalizeComponent = require(\"!../../../../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nimport __vue_script__ from \"!!babel-loader!../../../../../node_modules/vue-loader/lib/selector?type=script&index=0!./index.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-7052f966\\\",\\\"hasScoped\\\":false,\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../../../node_modules/vue-loader/lib/selector?type=template&index=0!./index.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = null\n/* scopeId */\nvar __vue_scopeId__ = null\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/pages/pagebuild/ui-lib/presentables/index.vue\n// module id = null\n// module chunks = ","\r\nimport ContractState from '@/pages/pagebuild/ui-lib/contract-state/index.vue'\r\n\r\nexport default {\r\n    name: 'contract-manager',\r\n\r\n    data() {\r\n        return {\r\n\r\n        }\r\n    },\r\n    components: {ContractState},\r\n    props: {\r\n        data: {\r\n            type: Object,\r\n            default() {\r\n                return null\r\n            }\r\n        }\r\n    },\r\n    mounted(){\r\n      console.log(this.data)\r\n    },\r\n    methods: {\r\n        showContractDetailHandler() {\r\n\r\n        }\r\n    }\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/pages/pagebuild/ui-lib/contract/index.js","<template>\r\n    <div>\r\n        <ul>\r\n            <li>\r\n                资源名称: {{data.resourceDetail.resourceName}}\r\n            </li>\r\n            <li>\r\n                资源类型: {{data.resourceDetail.resourceType}}\r\n            </li>\r\n            <li>\r\n                <el-button\r\n                        size=\"mini\"\r\n                        @click=\"showContractDetailHandler\">\r\n                    查看合同流程\r\n                </el-button>\r\n            </li>\r\n            <li>\r\n                <h3 class=\"contract-title\">合同流程</h3>\r\n                <contract-state class=\"contract-state-chart\" :data=\"data.contractDetail\"></contract-state>\r\n            </li>\r\n\r\n\r\n        </ul>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\n    import Contract from './index.js'\r\n\r\n    export default Contract\r\n</script>\r\n\r\n<style scoped lang=\"less\">\r\n    .contract-title {\r\n        margin-bottom: 6px;\r\n        text-align: center;\r\n    }\r\n</style>\n\n\n// WEBPACK FOOTER //\n// src/pages/pagebuild/ui-lib/contract/index.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('ul',[_c('li',[_vm._v(\"\\n            资源名称: \"+_vm._s(_vm.data.resourceDetail.resourceName)+\"\\n        \")]),_vm._v(\" \"),_c('li',[_vm._v(\"\\n            资源类型: \"+_vm._s(_vm.data.resourceDetail.resourceType)+\"\\n        \")]),_vm._v(\" \"),_c('li',[_c('el-button',{attrs:{\"size\":\"mini\"},on:{\"click\":_vm.showContractDetailHandler}},[_vm._v(\"\\n                查看合同流程\\n            \")])],1),_vm._v(\" \"),_c('li',[_c('h3',{staticClass:\"contract-title\"},[_vm._v(\"合同流程\")]),_vm._v(\" \"),_c('contract-state',{staticClass:\"contract-state-chart\",attrs:{\"data\":_vm.data.contractDetail}})],1)])])}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-bdfded6c\",\"hasScoped\":true,\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/pages/pagebuild/ui-lib/contract/index.vue\n// module id = null\n// module chunks = ","export default {\r\n    name: 'policy-manager',\r\n\r\n    data() {\r\n        return {}\r\n    },\r\n    props: {\r\n        data: {\r\n            type: Object,\r\n            default() {\r\n                return null\r\n            }\r\n        }\r\n    },\r\n    watch: {\r\n        data: 'formatPolicy'\r\n    },\r\n\r\n    mounted() {\r\n        this.formatPolicy()\r\n    },\r\n    methods: {\r\n        formatPolicy() {\r\n            this.parsePolicy(this.data)\r\n        },\r\n        parsePolicy(data) {\r\n            var segments = []\r\n            data.policy.forEach(function (block) {\r\n                var segment = {\r\n                    detail: block,\r\n                    states: block.fsmDescription,\r\n                    selected: false\r\n                }\r\n\r\n                segments.push(segment)\r\n            })\r\n\r\n            this.$set(this.data, 'segments', segments)\r\n        },\r\n        signPolicyHandler(policyData) {\r\n            var self = this;\r\n            if (!policyData.selectedSegmentId) {\r\n                return this.$message.warning('没有选择策略')\r\n            }\r\n\r\n            var tip = `presentable name: ${policyData.name}, resource name: ${policyData.resourceDetail.resourceName}`\r\n            this.$confirm(`<h3>合同详情</h3><p>${tip}。</p>确定签约合同？`, '提示', {\r\n                confirmButtonText: '确定',\r\n                cancelButtonText: '取消',\r\n                dangerouslyUseHTMLString: true,\r\n                type: 'warning'\r\n            }).then(() => {\r\n                window.QI.fetch('//api.freelog.com/v1/contracts', {\r\n                    method: 'POST',\r\n                    data: {\r\n                        contractType: 3,\r\n                        targetId: policyData.presentableId,\r\n                        segmentId: policyData.selectedSegmentId,\r\n                        serialNumber: policyData.serialNumber,\r\n                        partyTwo: window.__auth_info__.__auth_user_id__\r\n                    }\r\n                }).then((res) => {\r\n                    return res.json()\r\n                }).then((data) => {\r\n                    if (data.ret === 0 && data.errcode === 0) {\r\n                        self.$message.success('签约成功')\r\n                    } else {\r\n                        self.$message.error(data.msg)\r\n                    }\r\n                })\r\n            }).catch(() => {\r\n                //取消\r\n            });\r\n        }\r\n    }\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/pages/pagebuild/ui-lib/policy/index.js","<template>\r\n    <div>\r\n        <ul>\r\n            <el-button @click=\"signPolicyHandler\">创建合同</el-button>\r\n            <li v-for=\"segment in data.segments\" class=\"segment-row\">\r\n                <span class=\"segment-detail\">合同ID {{segment.detail.segmentId}}</span>\r\n                <el-radio class=\"select-btn\" v-model=\"data.selectedSegmentId\"\r\n                          :label=\"segment.detail.segmentId\">选择\r\n                </el-radio>\r\n            </li>\r\n        </ul>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\n    import Policy from './index.js'\r\n    export default Policy\r\n</script>\n\n\n// WEBPACK FOOTER //\n// src/pages/pagebuild/ui-lib/policy/index.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('ul',[_c('el-button',{on:{\"click\":_vm.signPolicyHandler}},[_vm._v(\"创建合同\")]),_vm._v(\" \"),_vm._l((_vm.data.segments),function(segment){return _c('li',{staticClass:\"segment-row\"},[_c('span',{staticClass:\"segment-detail\"},[_vm._v(\"合同ID \"+_vm._s(segment.detail.segmentId))]),_vm._v(\" \"),_c('el-radio',{staticClass:\"select-btn\",attrs:{\"label\":segment.detail.segmentId},model:{value:(_vm.data.selectedSegmentId),callback:function ($$v) {_vm.$set(_vm.data, \"selectedSegmentId\", $$v)},expression:\"data.selectedSegmentId\"}},[_vm._v(\"选择\\n            \")])],1)})],2)])}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-64b12160\",\"hasScoped\":false,\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/pages/pagebuild/ui-lib/policy/index.vue\n// module id = null\n// module chunks = ","var normalizeComponent = require(\"!../../../../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nimport __vue_script__ from \"!!babel-loader!../../../../../node_modules/vue-loader/lib/selector?type=script&index=0!./index.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-64b12160\\\",\\\"hasScoped\\\":false,\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../../../node_modules/vue-loader/lib/selector?type=template&index=0!./index.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = null\n/* scopeId */\nvar __vue_scopeId__ = null\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/pages/pagebuild/ui-lib/policy/index.vue\n// module id = null\n// module chunks = ","<template>\r\n    <div id=\"app\">\r\n        <tool-bar></tool-bar>\r\n        <el-dialog\r\n                :close-on-click-modal=\"false\"\r\n                title=\"合约管理列表\"\r\n                :visible.sync=\"shouldShowAuthDialog\"\r\n                :fullscreen=\"false\"\r\n                custom-class=\"auth-dialog\"\r\n                @close=\"_closeDialogHandler\"\r\n                width=\"50%\"\r\n                center>\r\n\r\n            <el-tabs v-model=\"activeTabName\" type=\"border-card\" @tab-remove=\"_removeTab\">\r\n                <el-tab-pane label=\"presentable list\" name=\"presentables\">\r\n                    <presentables :data=\"presentables\" @tabChange=\"_tabChange\"></presentables>\r\n                </el-tab-pane>\r\n                <el-tab-pane\r\n                        closable\r\n                        :key=\"item.name\"\r\n                        v-for=\"(item, index) in tabs\"\r\n                        :label=\"item.title\"\r\n                        :name=\"item.name\">\r\n                    <component :is=\"item.content\" :data=\"item.data\"></component>\r\n                </el-tab-pane>\r\n            </el-tabs>\r\n        </el-dialog>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\n    import ToolBar from '@/components/toolbar/index.vue'\r\n    import ContractState from './ui-lib/contract-state/index.vue'\r\n    import Presentables from './ui-lib/presentables/index.vue'\r\n    import Contract from './ui-lib/contract/index.vue'\r\n    import Policy from './ui-lib/policy/index.vue'\r\n\r\n\r\n    export default {\r\n        data() {\r\n            return {\r\n                shouldShowAuthDialog: true,\r\n                presentables: [],\r\n                tabs: [],\r\n                activeTabName: 'presentables'\r\n            }\r\n        },\r\n        components: {\r\n            ToolBar,\r\n            ContractState,\r\n            Presentables,\r\n            'contract-manager': Contract,\r\n            'policy-manager': Policy\r\n        },\r\n        mounted() {\r\n            this.$emit('ready', this)\r\n        },\r\n        methods: {\r\n            _tabChange(data) {\r\n              console.log(data);\r\n                var isExisted = this.tabs.some((tab) => {\r\n                    return tab.name === data.name\r\n                })\r\n\r\n                if (!isExisted) {\r\n                    this.tabs.push(data);\r\n                }\r\n                this.activeTabName = data.name;\r\n            },\r\n            _removeTab(targetName) {\r\n                let activeName = this.activeTabName;\r\n                if (activeName === targetName) {\r\n                    this.tabs.forEach((tab, index) => {\r\n                        if (tab.name === targetName) {\r\n                            let nextTab = this.tabs[index + 1] || this.tabs[index - 1];\r\n                            if (nextTab) {\r\n                                activeName = nextTab.name;\r\n                            } else {\r\n                                activeName = null\r\n                            }\r\n                        }\r\n                    });\r\n                }\r\n\r\n                this.activeTabName = activeName || 'presentables';\r\n                this.tabs = this.tabs.filter((t) => {\r\n                    return t.name !== targetName\r\n                })\r\n            },\r\n            _closeDialogHandler() {\r\n                //todo call callbacks\r\n                this.$emit('close')\r\n            },\r\n            showAuthDialog() {\r\n                this.shouldShowAuthDialog = true;\r\n            },\r\n            appendData(data) {\r\n                this.presentables.push(data)\r\n            }\r\n        }\r\n    }\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n    @import \"./app.less\";\r\n\r\n</style>\r\n\n\n\n// WEBPACK FOOTER //\n// src/pages/pagebuild/app.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{attrs:{\"id\":\"app\"}},[_c('tool-bar'),_vm._v(\" \"),_c('el-dialog',{attrs:{\"close-on-click-modal\":false,\"title\":\"合约管理列表\",\"visible\":_vm.shouldShowAuthDialog,\"fullscreen\":false,\"custom-class\":\"auth-dialog\",\"width\":\"50%\",\"center\":\"\"},on:{\"update:visible\":function($event){_vm.shouldShowAuthDialog=$event},\"close\":_vm._closeDialogHandler}},[_c('el-tabs',{attrs:{\"type\":\"border-card\"},on:{\"tab-remove\":_vm._removeTab},model:{value:(_vm.activeTabName),callback:function ($$v) {_vm.activeTabName=$$v},expression:\"activeTabName\"}},[_c('el-tab-pane',{attrs:{\"label\":\"presentable list\",\"name\":\"presentables\"}},[_c('presentables',{attrs:{\"data\":_vm.presentables},on:{\"tabChange\":_vm._tabChange}})],1),_vm._v(\" \"),_vm._l((_vm.tabs),function(item,index){return _c('el-tab-pane',{key:item.name,attrs:{\"closable\":\"\",\"label\":item.title,\"name\":item.name}},[_c(item.content,{tag:\"component\",attrs:{\"data\":item.data}})],1)})],2)],1)],1)}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-c4bdffc0\",\"hasScoped\":true,\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/pages/pagebuild/app.vue\n// module id = null\n// module chunks = ","function importHtml(href) {\r\n    return new Promise(function (resolve, reject) {\r\n        const link = document.createElement('link');\r\n        link.onload = resolve;\r\n        link.onerror = reject;\r\n        link.rel = 'import';\r\n        link.href = href;\r\n        document.head.appendChild(link);\r\n    });\r\n}\r\n\r\nexport default {\r\n    start() {\r\n        var self = this\r\n        var authInfo = window.__auth_info__;\r\n        var authErrorData = authInfo.__auth_error_info__\r\n\r\n        if (!authErrorData) {\r\n            self.loadWidgets()\r\n        } else {\r\n            window.FreeLogApp.trigger(window.FreeLogApp.ExceptionCode.invalidResponse, authErrorData.data || {})\r\n        }\r\n    },\r\n    getWidgets() {\r\n        var $page = document.querySelector('#js-page-container')\r\n        var $widgets = $page.querySelectorAll('.js-wc-widget');\r\n        return $widgets\r\n    },\r\n    loadWidgets() {\r\n        var $widgets = this.getWidgets()\r\n        var url = `//api.freelog.com/v1/nodes/${window.__auth_info__.__auth_node_id__}/presentables/`\r\n        Array.from($widgets).forEach(function (widget) {\r\n            var prensentableId = widget.getAttribute('data-widget-presentable-id');\r\n            if (prensentableId) {\r\n                window.QI.fetchPresentable(`${prensentableId}.data`)\r\n                    .then((res) => {\r\n                        return res.json()\r\n                    })\r\n                    .then(function (data) {\r\n                        window.FreeLogApp.trigger(window.FreeLogApp.ExceptionCode.invalidResponse, data)\r\n                    })\r\n                    .catch((err) => {\r\n                        //json解析不成功默认是成功情况,待优化判断逻辑\r\n                        importHtml(`${url}${prensentableId}.data`)\r\n                    })\r\n            } else {\r\n                //还没授权\r\n            }\r\n        })\r\n    }\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/pages/pagebuild/parser.js"],"sourceRoot":""}