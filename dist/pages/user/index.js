webpackJsonp([2],{"6UCX":function(t,e,a){"use strict";var n=a("G3VR"),o=a("HkHh"),r=a("kEHT"),s={data:function(){return{user:r.a.get("userInfo")||{}}},mounted:function(){},components:{NavTopBar:o.a},methods:{}},c={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("nav-top-bar"),t._v(" "),a("el-container",{staticClass:"app-container"},[t.user?a("el-header",{staticClass:"header"},[a("div",{staticClass:"banner-portrait inline"},[a("a",{attrs:{href:"/pages/user/index.html"}},[a("img",{staticClass:"portrait-img",attrs:{src:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRb_dez7L9rZGrxliWIWRzbH6H0u0BMePCrTB6wVbLtcfrAMKII",alt:""}})])]),t._v(" "),a("div",{staticClass:"banner-main  inline"},[a("div",{staticClass:"banner-main-hello"},[a("p",{staticClass:"user-name"},[t._v(t._s(t.user.nickname))])]),t._v(" "),a("div",{staticClass:"banner-main-detail"},[a("div",{staticClass:"user-account inline"},[a("label",[t._v("账户： ")]),t._v(t._s(t.user.mobile||t.user.email))])])])]):t._e(),t._v(" "),a("el-main",{staticStyle:{background:"white"}},[a("div",{attrs:{id:"main-app"}})])],1)],1)},staticRenderFns:[]},i=a("VU/8")(s,c,!1,function(t){a("T3LL")},"data-v-7f0ce4cb",null).exports;new n.a({el:"#app",render:function(t){return t(i)}});e.a=n.a},"7xrK":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=a("6UCX"),o=a("HkHh"),r=a("aIHY"),s={name:"clip-board",data:function(){return{}},props:{value:String},mounted:function(){console.log(this.value)},methods:{copyHandler:function(){console.log("copy");this.$refs.copyText.select();try{var t=document.execCommand("copy");this.$emit("copyDone",t)}catch(t){this.$emit("copyDone",!1)}}}},c={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{on:{click:this.copyHandler}},[e("textarea",{ref:"copyText",staticClass:"clip-text",domProps:{value:this.value}}),this._v(" "),this._t("default")],2)},staticRenderFns:[]},i={name:"account-list",data:function(){return{cardStyle:{padding:"5px","min-height":"150px",display:"flex","justify-content":"center","align-items":"center","flex-wrap":"wrap"},accounts:[]}},components:{ClipBoard:a("VU/8")(s,c,!1,function(t){a("Vvxu")},"data-v-eaf1796a",null).exports},mounted:function(){var t=this;this.loadAssets().then(this.formatAssets.bind(this)).then(function(e){t.accounts=e})},methods:{handleCommand:function(t){switch(t.type){case"detail":this.viewAccountDetail(t.data);break;case"download":this.downloadKeyStore(t.data.cardNo);break;case"clear":this.clearKeyStore(t.data.cardNo);break;case"pay":this.gotoPayHandler(t.data)}},viewAccountDetail:function(t){location.href="/pages/account/detail.html?accountId="+t.accountId},gotoPayHandler:function(t){location.href="/pages/transfer.html?fromAccountId="+t.accountId},downloadFile:function(t,e){var a=document.createElement("a"),n=new Blob([e]);a.download=t,a.href=URL.createObjectURL(n),document.body.appendChild(a),a.click(),a.remove()},downloadKeyStore:function(t){var e=this;return this.$axios.get("/v1/pay/accounts/downLoadKeyStore",{params:{address:t}}).then(function(a){try{var n=new Blob([JSON.stringify(a.data,null,2)],{type:"application/json"});e.downloadFile(t,n)}catch(t){e.$message.error(t)}}).catch(function(t){console.log(t)})},clearKeyStore:function(t){var e=this;this.$confirm("确定清除服务器上的keystore文件？").then(function(a){return e.$axios.get("/v1/pay/accounts/clearKeyStore",{params:{address:t}}).then(function(t){console.log(t.data);var a=t.data;0===a.ret&&0===a.errcode?e.$message.success("成功清除"):e.$message.error(a.msg)}).catch(function(t){console.log(t)})}).catch(function(t){})},formatAssets:function(t){return console.log(t),t.forEach(function(t){t.showDetail=r.a[t.accountType]}),t},copyDoneHandler:function(t){t?this.$message.success("复制成功"):this.$message.error("复制失败")},loadAssets:function(){return this.$axios.get("/v1/pay/accounts").then(function(t){return t.data.data}).catch(function(t){console.log(t)})}}},l={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"assets-wrap"},[a("el-row",[t._l(t.accounts,function(e,n){return a("el-col",{key:n,attrs:{span:6}},[a("el-card",{staticClass:"account-card",attrs:{"body-style":t.cardStyle}},[a("p",{staticClass:"account-card-info"},[a("label",[t._v("币种")]),t._v("\n          "+t._s(e.showDetail.name))]),t._v(" "),a("p",{staticClass:"account-card-info"},[a("label",[t._v("账户地址")]),t._v(" "),e.accountId?a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:e.accountId,placement:"top"}},[a("clip-board",{on:{copyDone:t.copyDoneHandler},model:{value:e.accountId,callback:function(a){t.$set(e,"accountId",a)},expression:"account.accountId"}},[a("a",{attrs:{href:"javascript:;"}},[a("i",{staticClass:"el-icon-fa-clipboard"})])])],1):a("span",[t._v("账户不存在")])],1),t._v(" "),a("p",{staticClass:"account-card-info"},[a("label",[t._v("账户余额")]),a("span",[t._v(t._s(t._f("humanizeCurrency")(e.balance))+" "+t._s(e.showDetail.abbr))])]),t._v(" "),1===e.status?a("p",{staticClass:"account-card-info"},[a("el-dropdown",{on:{command:t.handleCommand}},[a("span",{staticClass:"el-dropdown-link"},[t._v("\n                                          账户操作"),a("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),t._v(" "),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",{attrs:{command:{type:"detail",data:e}}},[t._v("\n                详情\n              ")]),t._v(" "),a("el-dropdown-item",{attrs:{command:{type:"pay",data:e}}},[t._v("\n                去转账\n              ")]),t._v(" "),a("el-dropdown-item",{attrs:{command:{type:"download",data:e}}},[t._v("下载keystore\n              ")]),t._v(" "),a("el-dropdown-item",{attrs:{command:{type:"clear",data:e}}},[t._v("清除下载keystore\n              ")])],1)],1)],1):t._e()])],1)}),t._v(" "),a("el-col",{attrs:{span:6}},[a("el-card",{staticClass:"account-card",attrs:{"body-style":t.cardStyle}},[a("a",{staticClass:"add-account-btn",attrs:{href:"/pages/account/create.html"}},[a("p",[a("i",{staticClass:"el-icon-plus"})]),t._v(" "),a("p",[t._v("添加账户")])])])],1)],2)],1)},staticRenderFns:[]},d=a("VU/8")(i,l,!1,function(t){a("o6gi")},"data-v-5ca7da02",null).exports,u=a("kEHT"),f=a("kIFb"),p={name:"contract-list",data:function(){return{contracts:[]}},mounted:function(){var t=this;this.loadContracts().then(this.loadResourcesDetail.bind(this)).then(this.format.bind(this)).then(function(e){t.contracts=e})},methods:{format:function(t){var e=[];return t.forEach(function(t){t.resourceDetail&&(t._status={type:f.b[t.status],text:f.c[t.status]},e.push(t))}),e},viewDetailHandler:function(t){location.href="/pages/trade/detail.html?contractId="+t.contractId},loadResource:function(t){var e=this;return new Promise(function(a){e.$axios.get("/v1/resources/"+t).then(function(t){a(0===t.data.errcode?t.data.data:null)}).catch(function(){a(null)})})},loadResourcesDetail:function(t){var e=this,a=[];return t.forEach(function(t){a.push(e.loadResource(t.resourceId))}),Promise.all(a).then(function(e){var a={};return e.forEach(function(t){t&&(a[t.resourceId]=t)}),t.forEach(function(t){t.resourceDetail=a[t.resourceId]||null}),t})},loadContracts:function(){var t=u.a.get("userInfo");return this.$axios.get("/v1/contracts",{params:{contractType:3,partyTwo:t.userId}}).then(function(t){if(0===t.data.errcode){var e=t.data.data;return e&&e.dataList||[]}throw new Error(t.data.msg)}).catch(function(t){console.log(t)})}}},m={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"contracts-wrap"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.contracts}},[a("el-table-column",{attrs:{label:"日期"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("a",[t._v(t._s(t._f("fmtDate")(e.row.createDate)))])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"resourceDetail.resourceName",label:"资源名"}}),t._v(" "),a("el-table-column",{attrs:{prop:"resourceDetail.resourceType",label:"资源类型"}}),t._v(" "),a("el-table-column",{attrs:{prop:"address",label:"合同状态"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-tag",{attrs:{type:e.row._status.type}},[t._v(t._s(e.row._status.text))])]}}])}),t._v(" "),a("el-table-column",{scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-dropdown",{attrs:{"split-button":"",type:"primary"},on:{click:function(a){t.viewDetailHandler(e.row)}}},[t._v("\n          详情\n          "),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",[t._v("操作1")]),t._v(" "),a("el-dropdown-item",[t._v("操作2")]),t._v(" "),a("el-dropdown-item",[t._v("操作3")])],1)],1)]}}])})],1)],1)},staticRenderFns:[]},v=a("VU/8")(p,m,!1,function(t){a("C0Cz")},"data-v-c773567e",null).exports,h=a("nOLo"),_={name:"user-order-list",data:function(){return{orders:[]}},mounted:function(){var t=this;this.loadOrders().then(this.loadOrderDetail.bind(this)).then(this.format.bind(this)).then(function(e){t.orders=e||[]})},methods:{format:function(t){var e=[];return t&&t.forEach(function(t){t._statusInfo=h.a[t.status],e.push(t)}),e},loadResources:function(t){var e=this,a={},n=t.map(function(t){return a[t.resourceId]=t,e.$axios.get("/v1/resources/"+t.resourceId).then(function(t){return t.data.data})});return Promise.all(n).then(function(t){return t.forEach(function(t){a[t.resourceId]&&Object.assign(a[t.resourceId],t)}),Object.values(a)})},mergeResinOrder:function(t,e){var a={};return e.forEach(function(t){a[t.targetId]=t}),t.forEach(function(t){a[t.contractId]&&(a[t.contractId].contractDetail=t)}),Object.values(a)},loadOrderDetail:function(t){var e=this;return new Promise(function(a){var n=t.map(function(t){return t.targetId});e.$axios.get("/v1/contracts/contractRecords",{params:{contractIds:n.join(",")}}).then(function(n){if(0===n.data.errcode)return e.loadResources(n.data.data).then(function(a){return e.mergeResinOrder(a,t)}).then(a);a(null)}).catch(function(t){console.error(t),a(null)})})},viewDetailHandler:function(t){location.href="/pages/order/detail.html?orderId="+t.orderId},loadResource:function(t){var e=this;return new Promise(function(a){e.$axios.get("/v1/resources/"+t).then(function(t){a(0===t.data.errcode?t.data.data:null)}).catch(function(){a(null)})})},loadOrders:function(){return this.$axios.get("/v1/pay").then(function(t){if(0===t.data.errcode){var e=t.data.data;return e&&e.dataList||[]}throw new Error(t.data.msg)}).catch(function(t){console.log(t)})}}},w={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"contracts-wrap"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.orders}},[a("el-table-column",{attrs:{label:"日期"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("a",[t._v(t._s(t._f("fmtDate")(e.row.createDate)))])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"contractDetail.resourceName",label:"资源名"}}),t._v(" "),a("el-table-column",{attrs:{prop:"contractDetail.resourceType",label:"资源类型"}}),t._v(" "),a("el-table-column",{attrs:{prop:"orderId",width:"210",label:"订单号"}}),t._v(" "),a("el-table-column",{attrs:{prop:"address",label:"订单状态"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n        "+t._s(e.row._statusInfo.desc)+"\n      ")]}}])}),t._v(" "),a("el-table-column",{scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-dropdown",{attrs:{"split-button":"",type:"primary"},on:{click:function(a){t.viewDetailHandler(e.row)}}},[t._v("\n          详情\n          "),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",[t._v("操作1")]),t._v(" "),a("el-dropdown-item",[t._v("操作2")]),t._v(" "),a("el-dropdown-item",[t._v("操作3")])],1)],1)]}}])})],1)],1)},staticRenderFns:[]},b=a("VU/8")(_,w,!1,function(t){a("Dl1y")},"data-v-a8f0571a",null).exports,g={data:function(){return{activeTabName:"trade"}},mounted:function(){},components:{NavTopBar:o.a,AccountList:d,ContractList:v,UserOrderList:b},methods:{loadUserInfo:function(){var t=this;window.fetch("/api/v1/userinfos/10024",{credentials:"same-origin"}).then(function(t){return t.json()}).then(function(e){t.user=e.data})}}},y={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"app"}},[a("div",{staticClass:"main-content"},[a("el-main",[a("account-list"),t._v(" "),a("div",{staticClass:"main-content"},[a("el-tabs",{model:{value:t.activeTabName,callback:function(e){t.activeTabName=e},expression:"activeTabName"}},[a("el-tab-pane",{attrs:{label:"已购买资源",name:"trade"}},[a("contract-list")],1),t._v(" "),a("el-tab-pane",{attrs:{label:"支付订单",name:"orders"}},[a("user-order-list")],1)],1)],1)],1)],1)])},staticRenderFns:[]},C=a("VU/8")(g,y,!1,function(t){a("U5wB")},"data-v-14422b75",null).exports;new n.a({el:"#main-app",render:function(t){return t(C)}})},C0Cz:function(t,e,a){},Dl1y:function(t,e,a){},HkHh:function(t,e,a){"use strict";var n=a("kEHT"),o={name:"nav-top-bar",data:function(){return{user:n.a.get("userInfo")||{}}},mounted:function(){},methods:{checkLoginStatus:function(){this.user.userId||location.replace("/pages/user/login.html")},logoutHandler:function(){this.$axios.get("/v1/passport/logout").then(function(t){n.a.remove("userInfo"),location.replace("/pages/user/login.html")})},handleNavTopCommand:function(t){switch(t){case"gotoAccountSetting":location.href="/pages/account/security.html"}}}},r={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"nav-top-wrapper"},[t.user?a("div",{staticClass:"nav-top-container"},[a("ul",{staticClass:"nav-top-right"},[a("li",{staticClass:"nav-top-item"},[a("el-dropdown",{on:{command:t.handleNavTopCommand}},[a("span",{staticClass:"el-dropdown-link"},[t._v("\n                      "+t._s(t.user.nickname)),a("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),t._v(" "),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",{attrs:{command:"gotoAccountSetting"}},[t._v("账户设置")])],1)],1)],1),t._v(" "),a("li",{staticClass:"nav-top-item",on:{click:t.logoutHandler}},[t._v("退出")]),t._v(" "),t._m(0)])]):t._e()])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("li",{staticClass:"nav-top-item"},[e("a",{attrs:{href:"/pages/user/index.html"}},[this._v("我的feth")])])}]},s=a("VU/8")(o,r,!1,function(t){a("edu7")},"data-v-0f5da88c",null);e.a=s.exports},T3LL:function(t,e,a){},U5wB:function(t,e,a){},Vvxu:function(t,e,a){},edu7:function(t,e,a){},kIFb:function(t,e,a){"use strict";a.d(e,"a",function(){return n}),a.d(e,"c",function(){return o}),a.d(e,"b",function(){return r});var n={uncreated:-1,initial:1,running:2,activated:3,userTerminated:4,sysTerminated:5,terminated:6,invalid:0},o={0:"资源未生效","-1":"未创建合同",1:"未开始执行",2:"执行中",3:"生效中",4:"用户终止",5:"系统终止",6:"合同已终止"},r={0:"info","-1":"warning",1:"",2:"",3:"success",4:"info",5:"info",6:"info"}},nOLo:function(t,e,a){"use strict";e.a={1:{value:1,desc:"正在发起"},2:{value:2,desc:"已支付"},3:{value:3,desc:"失败"}}},o6gi:function(t,e,a){}},["7xrK"]);